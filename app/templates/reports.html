{% extends "base.html" %}
{% block content %}

<div class="container py-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h3 class="m-0">ğŸ“¸ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</h3>
    <a href="/admin" class="btn btn-sm btn-outline-secondary">â†©ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…ÙŠÙ†</a>
  </div>

  <!-- ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¨Ø³ÙŠØ·Ø© -->
  {% if not reports %}
    <div class="alert alert-info">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù„Ø§ØºØ§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</div>
  {% else %}

  <div class="card">
    <div class="card-header d-flex align-items-center justify-content-between">
      <strong>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</strong>
      <span class="badge bg-secondary">{{ reports|length }}</span>
    </div>

    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Ø§Ù„Ù‡Ø¯Ù</th>
            <th>Ø§Ù„Ù…Ø¨Ù„Ù‘ÙØº</th>
            <th>Ø§Ù„Ø³Ø¨Ø¨</th>
            <th>ØªØ§Ø±ÙŠØ®</th>
            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
            <th class="text-end">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody>
          {% for r in reports %}
          <tr>
            <td class="fw-bold">{{ r.id }}</td>

            <!-- Ø§Ù„Ù‡Ø¯Ù (Ù…Ù†Ø´ÙˆØ±/ØµÙˆØ±Ø©) -->
            <td>
              {% set _item_id = r.item_id if r.item_id is defined else None %}
              {% set _img_i   = r.image_index if r.image_index is defined else None %}
              {% if _img_i is not none %}
                ØµÙˆØ±Ø© <span class="badge bg-dark">#{{ _img_i }}</span>
                â€” Ù…Ù†Ø´ÙˆØ± <a href="/items/{{ _item_id }}" target="_blank" class="text-decoration-none">#{{ _item_id }}</a>
              {% else %}
                Ù…Ù†Ø´ÙˆØ± <a href="/items/{{ _item_id }}" target="_blank" class="text-decoration-none">#{{ _item_id }}</a>
              {% endif %}
            </td>

            <!-- Ø§Ù„Ù…Ø¨Ù„Ù‘Øº -->
            <td>
              {% if r.reporter is defined and r.reporter %}
                {{ (r.reporter.first_name ~ ' ' ~ r.reporter.last_name)|trim }}
                <small class="text-muted">(#{{ r.reporter.id }})</small>
              {% else %}
                Ù…Ø³ØªØ®Ø¯Ù… <span class="text-muted">#{{ r.reporter_id }}</span>
              {% endif %}
            </td>

            <!-- Ø§Ù„Ø³Ø¨Ø¨ -->
            <td style="max-width: 320px">
              <div class="text-truncate" title="{{ r.reason }}">{{ r.reason }}</div>
              {% if r.note %}
                <div class="small text-muted text-truncate" title="{{ r.note }}">Ù…Ù„Ø§Ø­Ø¸Ø§Øª: {{ r.note }}</div>
              {% endif %}
            </td>

            <!-- Ø§Ù„ØªØ§Ø±ÙŠØ® -->
            <td>
              {% if r.created_at %}{{ r.created_at.strftime("%Y-%m-%d %H:%M") }}{% else %}â€”{% endif %}
            </td>

            <!-- Ø§Ù„Ø­Ø§Ù„Ø© -->
            <td>
              {% set st = (r.status or 'pending')|lower %}
              {% if st == 'pending' %}
                <span class="badge bg-warning text-dark">Ø¨Ø§Ù†ØªØ¸Ø§Ø±</span>
              {% elif st in ['resolved','done','closed'] %}
                <span class="badge bg-success">Ù…ÙØ¹Ø§Ù„Ø¬</span>
              {% elif st in ['rejected','dismissed'] %}
                <span class="badge bg-secondary">Ù…Ø±ÙÙˆØ¶</span>
              {% else %}
                <span class="badge bg-info text-dark">{{ r.status }}</span>
              {% endif %}
            </td>

            <!-- Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
            <td class="text-end">
              <div class="btn-group btn-group-sm" role="group" aria-label="actions">
                <!-- Ù…Ø¨Ø¯Ø¦ÙŠÙ‹Ø§ Ù†Ø±Ø³Ù„ Ø¥Ù„Ù‰ Ù…Ø³Ø§Ø± Ø¹Ø§Ù… (ÙŠÙ…ÙƒÙ†Ùƒ ØªÙ†ÙÙŠØ°Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§): /admin/reports/{id}/resolve -->
                <form method="post" action="/admin/reports/{{ r.id }}/resolve" class="d-inline">
                  {% if r.image_index is defined and r.image_index is not none %}
                    <input type="hidden" name="action" value="remove_image">
                    <button class="btn btn-outline-danger" title="Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©">ğŸ—‘ï¸ ØµÙˆØ±Ø©</button>
                  {% else %}
                    <input type="hidden" name="action" value="remove_item">
                    <button class="btn btn-outline-danger" title="Ø¥Ù„ØºØ§Ø¡ Ù†Ø´Ø± Ø§Ù„Ù…Ù†Ø´ÙˆØ±">ğŸ—‘ï¸ Ù…Ù†Ø´ÙˆØ±</button>
                  {% endif %}
                </form>

                <form method="post" action="/admin/reports/{{ r.id }}/resolve" class="d-inline">
                  <input type="hidden" name="action" value="warn_owner">
                  <button class="btn btn-outline-warning" title="ØªØ­Ø°ÙŠØ± Ø§Ù„Ù…Ø§Ù„Ùƒ">âš ï¸ ØªØ­Ø°ÙŠØ±</button>
                </form>

                <form method="post" action="/admin/reports/{{ r.id }}/resolve" class="d-inline">
                  <input type="hidden" name="action" value="reject">
                  <button class="btn btn-outline-secondary" title="Ø±ÙØ¶ Ø§Ù„Ø¨Ù„Ø§Øº">âœ–ï¸ Ø±ÙØ¶</button>
                </form>

                <form method="post" action="/admin/reports/{{ r.id }}/resolve" class="d-inline">
                  <input type="hidden" name="action" value="mark_done">
                  <button class="btn btn-outline-success" title="ÙˆØ¶Ø¹ ÙƒÙ…ÙØ¹Ø§Ù„Ø¬">âœ”ï¸ ØªÙ…</button>
                </form>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {% endif %}
</div>

{% endblock %}
