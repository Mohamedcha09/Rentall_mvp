{# app/templates/_badges.html #}
{% macro render_badges(u, size='18px') -%}
  {# Supports dict (session_user) or ORM object (User) #}
  {% set is_dict = u is mapping %}

  {# Verified #}
  {% if is_dict %}
    {% set is_verified = u.get('is_verified', False) %}
  {% else %}
    {% set is_verified = (u|attr('is_verified')) if (u is not none and (u|attr('is_verified') is not undefined)) else False %}
  {% endif %}

  {# New (<2 months) or manually flagged yellow #}
  {% if is_dict %}
    {% set is_new_under_2m = u.get('is_new_under_2m', False) %}
    {% set badge_new_yellow = u.get('badge_new_yellow', False) %}
  {% else %}
    {% set is_new_under_2m = (u|attr('is_new_under_2m')) if (u is not none and (u|attr('is_new_under_2m') is not undefined)) else False %}
    {% set badge_new_yellow = (u|attr('badge_new_yellow')) if (u is not none and (u|attr('badge_new_yellow') is not undefined)) else False %}
  {% endif %}
  {% set show_yellow = is_new_under_2m or badge_new_yellow %}

  {# Only two badges: yellow and purple #}
  {% if show_yellow %}
    <img
      src="/static/img/jaune.png"
      alt="New"
      title="New Account"
      style="height:{{ size }};width:auto;vertical-align:middle;margin-inline-start:.25rem;"
    >
  {% endif %}

  {% if is_verified %}
    <img
      src="/static/img/violet.png"
      alt="Verified"
      title="Verified Account by Admin"
      style="height:{{ size }};width:auto;vertical-align:middle;margin-inline-start:.25rem;"
    >
  {% endif %}
{%- endmacro %}
