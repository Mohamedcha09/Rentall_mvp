{# app/templates/search.html #}
{% extends "base.html" %}

{% block content %}

{# Ù†Ø­Ø³Ø¨ Ø£Ø·ÙˆØ§Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© #}
{% set items_len = (items|length if items is defined and items else 0) %}
{% set users_len = (users|length if users is defined and users else 0) %}
{% set all_empty = (items_len == 0 and users_len == 0) %}

<style>
  /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ÙØ®Ù… */
  .search-wrap{
    background: color-mix(in oklab, var(--surface) 88%, transparent);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 12px;
    box-shadow: 0 6px 20px rgba(0,0,0,.04);
  }
  .search-wrap .form-control{
    border: none; background: transparent; box-shadow: none;
  }
  .search-wrap .btn{ border-radius: 12px; }

  /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù†ØªØ§Ø¦Ø¬ */
  .lux-card{
    border:1px solid var(--border);
    background: color-mix(in oklab, var(--surface) 96%, transparent);
    border-radius:16px; overflow:hidden;
    box-shadow: 0 8px 26px rgba(0,0,0,.05);
  }
  .lux-card .card-header{
    background: transparent; border-bottom: 1px dashed var(--border);
    font-weight:800;
  }

  /* Ø´Ø¨ÙƒØ© Ø§Ù„Ø¹Ù†Ø§ØµØ± */
  .row-items{display:grid; gap:14px; grid-template-columns:1fr;}
  @media (min-width:576px){ .row-items{ grid-template-columns: 1fr; } }

  /* Ø¹Ù†ØµØ± Ù†ØªÙŠØ¬Ø© */
  .result-item{display:flex; gap:12px; align-items:center; text-decoration:none; color:inherit; padding:6px; border-radius:12px;}
  .result-item:hover{ background: color-mix(in oklab, var(--surface) 90%, transparent); }
  .result-thumb{width:140px; aspect-ratio:16/9; border-radius:12px; overflow:hidden; background:#eef1f4; flex:0 0 140px;}
  .result-thumb img{width:100%; height:100%; object-fit:cover; display:block;}
  .badge-soft{background: color-mix(in oklab, var(--primary, #6c5ce7) 18%, white); border:1px solid var(--border);}

  /* Ø­Ø§Ù„Ø© Ø§Ù„ÙØ±Ø§Øº Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
  .empty-box{
    display:flex; align-items:center; justify-content:center;
    min-height:180px; padding:16px;
  }
  .empty-box img{ max-width:300px; width:80%; height:auto; object-fit:contain; opacity:.98; }

  /* Ø­Ø§Ù„Ø© Ø§Ù„ÙØ±Ø§Øº Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„ØµÙØ­Ø© */
  .empty-all{
    display:flex; align-items:center; justify-content:center; padding:28px;
  }
  .empty-all img{ max-width:420px; width:86%; height:auto; object-fit:contain; opacity:.98; }

  /* Ø¹Ù†ÙˆØ§Ù† Ø£Ù†ÙŠÙ‚ */
  .section-title{
    font-weight:900; letter-spacing:.2px;
    border-inline-start: 4px solid color-mix(in oklab, var(--primary, #6c5ce7) 65%, black);
    padding-inline-start:10px;
  }
</style>


<h4 class="mb-3 section-title">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†: <span class="text-info">{{ q or 'â€”' }}</span></h4>

{% if all_empty %}
  {# ÙƒÙ„Ø§ Ø§Ù„Ù‚Ø§Ø¦Ù…ØªÙŠÙ† ÙØ§Ø±Øº â†’ Ù†Ø®ÙÙŠ Ø§Ù„Ø¨Ø·Ø§Ù‚ØªÙŠÙ† ÙˆÙ†ÙØ¸Ù‡Ø± aon.png #}
  <div class="empty-all">
    <img src="{{ url_for('static', path='photo/aon.png') }}" alt="Ù„Ø§ Ù†ØªØ§Ø¦Ø¬">
  </div>
{% else %}
  <div class="row g-3">

    {# Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© #}
    <div class="col-12 col-lg-6">
      <div class="card lux-card h-100">
        <div class="card-header">Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©</div>
        <div class="card-body">
          {% if items_len > 0 %}
            <div class="row-items">
              {% for it in items %}
                <a class="result-item" href="/items/{{ it.id }}">
                  <div class="result-thumb">
                    {% if it.image_path %}
                      {% set src = it.image_path if it.image_path.startswith('http') else '/' ~ it.image_path.lstrip('/') %}
                      <img src="{{ src }}" alt="{{ it.title }}">
                    {% else %}
                      <img src="/static/placeholder.png" alt="">
                    {% endif %}
                  </div>
                  <div class="flex-grow-1">
                    <div class="fw-bold text-truncate">{{ it.title }}</div>
                    <div class="small text-muted mt-1 d-flex align-items-center gap-2">
                      {% if it.city %}<span>ğŸ™ï¸ {{ it.city }}</span>{% endif %}
                      {% if it.price_per_day is not none %}
                        <span class="badge badge-soft">{{ it.price_per_day }} Ø¯/ÙŠÙˆÙ…</span>
                      {% endif %}
                    </div>
                  </div>
                </a>
              {% endfor %}
            </div>
          {% else %}
            {# Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙØ§Ø±ØºØ© â†’ ØµÙˆØ±Ø© kon.png Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¨Ø¯Ù„ Ø§Ù„Ù†Øµ #}
            <div class="empty-box">
              <img src="{{ url_for('static', path='photo/kon.png') }}" alt="Ù„Ø§ Ø¹Ù†Ø§ØµØ±">
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    {# Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚ÙŠÙ† #}
    <div class="col-12 col-lg-6">
      <div class="card lux-card h-100">
        <div class="card-header">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚ÙˆÙ†</div>
        <div class="card-body">
          {% if users_len > 0 %}
            <ul class="list-group list-group-flush">
              {% for u in users %}
                <li class="list-group-item d-flex align-items-center gap-3" style="background:transparent;border-color:var(--border)">
                  {% if u.avatar_path %}
                    {% set avatar_src = u.avatar_path if u.avatar_path.startswith('http') else '/' ~ u.avatar_path.lstrip('/') %}
                    <img src="{{ avatar_src }}" class="rounded-circle" style="width:42px;height:42px;object-fit:cover" alt="{{ u.name }}">
                  {% else %}
                    <div class="rounded-circle d-flex align-items-center justify-content-center"
                         style="width:42px;height:42px;background:rgba(0,0,0,.05);border:1px solid var(--border)">
                      <span>ğŸ‘¤</span>
                    </div>
                  {% endif %}
                  <div class="flex-grow-1">
                    <div class="fw-bold text-truncate">{{ u.name }}</div>
                  </div>
                  <a class="btn btn-sm btn-primary" href="/users/{{ u.id }}">Ø¹Ø±Ø¶</a>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            {# Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† ÙØ§Ø±ØºÙˆÙ† â†’ ØµÙˆØ±Ø© don.png Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¨Ø¯Ù„ Ø§Ù„Ù†Øµ #}
            <div class="empty-box">
              <img src="{{ url_for('static', path='photo/don.png') }}" alt="Ù„Ø§ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†">
            </div>
          {% endif %}
        </div>
      </div>
    </div>

  </div>
{% endif %}

{% endblock %}
