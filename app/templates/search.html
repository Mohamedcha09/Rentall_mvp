{# app/templates/search.html #}
{% extends "base.html" %}

{% block content %}

{# Compute result lengths once #}
{% set items_len = (items|length if items is defined and items else 0) %}
{% set users_len = (users|length if users is defined and users else 0) %}
{% set all_empty = (items_len == 0 and users_len == 0) %}

<style>
  /* Fancy search bar */
  .search-wrap{
    background: color-mix(in oklab, var(--surface) 88%, transparent);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 12px;
    box-shadow: 0 6px 20px rgba(0,0,0,.04);
  }
  .search-wrap .form-control{
    border: none; background: transparent; box-shadow: none;
  }
  .search-wrap .btn{ border-radius: 12px; }

  /* Result cards */
  .lux-card{
    border:1px solid var(--border);
    background: color-mix(in oklab, var(--surface) 96%, transparent);
    border-radius:16px; overflow:hidden;
    box-shadow: 0 8px 26px rgba(0,0,0,.05);
  }
  .lux-card .card-header{
    background: transparent; border-bottom: 1px dashed var(--border);
    font-weight:800;
  }

  /* Items grid */
  .row-items{display:grid; gap:14px; grid-template-columns:1fr;}
  @media (min-width:576px){ .row-items{ grid-template-columns: 1fr; } }

  /* Single result item */
  .result-item{display:flex; gap:12px; align-items:center; text-decoration:none; color:inherit; padding:6px; border-radius:12px;}
  .result-item:hover{ background: color-mix(in oklab, var(--surface) 90%, transparent); }
  .result-thumb{width:140px; aspect-ratio:16/9; border-radius:12px; overflow:hidden; background:#eef1f4; flex:0 0 140px;}
  .result-thumb img{width:100%; height:100%; object-fit:cover; display:block;}
  .badge-soft{background: color-mix(in oklab, var(--primary, #6c5ce7) 18%, white); border:1px solid var(--border);}

  /* Empty state inside a card */
  .empty-box{
    display:flex; align-items:center; justify-content:center;
    min-height:180px; padding:16px;
  }
  .empty-box img{ max-width:300px; width:80%; height:auto; object-fit:contain; opacity:.98; }

  /* Full-page empty state */
  .empty-all{
    display:flex; align-items:center; justify-content:center; padding:28px;
  }
  .empty-all img{ max-width:420px; width:86%; height:auto; object-fit:contain; opacity:.98; }

  /* Neat section title */
  .section-title{
    font-weight:900; letter-spacing:.2px;
    border-inline-start: 4px solid color-mix(in oklab, var(--primary, #6c5ce7) 65%, black);
    padding-inline-start:10px;
  }
</style>


<h4 class="mb-3 section-title">Search results for: <span class="text-info">{{ q or '‚Äî' }}</span></h4>

{% if all_empty %}
  {# Both lists are empty ‚Üí hide both cards and show aon.png #}
  <div class="empty-all">
    <img src="{{ url_for('static', path='photo/aon.png') }}" alt="No results">
  </div>
{% else %}
  <div class="row g-3">

    {# Matching items card #}
    <div class="col-12 col-lg-6">
      <div class="card lux-card h-100">
        <div class="card-header">Matching Items</div>
        <div class="card-body">
          {% if items_len > 0 %}
            <div class="row-items">
              {% for it in items %}
                <a class="result-item" href="/items/{{ it.id }}">
                  <div class="result-thumb">
                    {% if it.image_path %}
                      {% set src = it.image_path if it.image_path.startswith('http') else '/' ~ it.image_path.lstrip('/') %}
                      <img src="{{ src }}" alt="{{ it.title }}">
                    {% else %}
                      <img src="/static/placeholder.png" alt="">
                    {% endif %}
                  </div>
                  <div class="flex-grow-1">
                    <div class="fw-bold text-truncate">{{ it.title }}</div>
                    <div class="small text-muted mt-1 d-flex align-items-center gap-2">
                      {% if it.city %}<span>üèôÔ∏è {{ it.city }}</span>{% endif %}
                      {% if it.price_per_day is not none %}
                        <span class="badge badge-soft">{{ it.display_price }} {{ it.display_currency }} D/day</span>
                      {% endif %}
                    </div>
                  </div>
                </a>
              {% endfor %}
            </div>
          {% else %}
            {# Items empty ‚Üí show kon.png inside the card instead of text #}
            <div class="empty-box">
              <img src="{{ url_for('static', path='photo/kon.png') }}" alt="No items">
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    {# Matching users card #}
    <div class="col-12 col-lg-6">
      <div class="card lux-card h-100">
        <div class="card-header">Matching Users</div>
        <div class="card-body">
          {% if users_len > 0 %}
            <ul class="list-group list-group-flush">
              {% for u in users %}
                <li class="list-group-item d-flex align-items-center gap-3" style="background:transparent;border-color:var(--border)">
                  {% if u.avatar_path %}
                    {% set avatar_src = u.avatar_path if u.avatar_path.startswith('http') else '/' ~ u.avatar_path.lstrip('/') %}
                    <img src="{{ avatar_src }}" class="rounded-circle" style="width:42px;height:42px;object-fit:cover" alt="{{ u.name }}">
                  {% else %}
                    <div class="rounded-circle d-flex align-items-center justify-content-center"
                         style="width:42px;height:42px;background:rgba(0,0,0,.05);border:1px solid var(--border)">
                      <span>üë§</span>
                    </div>
                  {% endif %}
                  <div class="flex-grow-1">
                    <div class="fw-bold text-truncate">{{ u.name }}</div>
                  </div>
                  <a class="btn btn-sm btn-primary" href="/users/{{ u.id }}">View</a>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            {# Users empty ‚Üí show don.png inside the card instead of text #}
            <div class="empty-box">
              <img src="{{ url_for('static', path='photo/don.png') }}" alt="No users">
            </div>
          {% endif %}
        </div>
      </div>
    </div>

  </div>
{% endif %}

{% endblock %}
