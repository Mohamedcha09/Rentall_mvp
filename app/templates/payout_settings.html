{% extends "base.html" %}

{% block head %}
<style>
.card{
  border:1px solid var(--border);
  border-radius:18px;
  padding:20px;
  background:var(--surface);
  margin-bottom:18px;
}
.method{
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
  margin-bottom:14px;
}
.method.active{
  border-color:#6d5dfc;
  background:rgba(109,93,252,.05);
}
.method-title{
  display:flex;
  align-items:center;
  gap:10px;
  font-weight:600;
}
.field{margin-top:14px}
.field input, .field select{
  width:100%;
  padding:12px 14px;
  border-radius:12px;
  border:1px solid var(--border);
}
.hint{font-size:.85rem;opacity:.7;margin-top:4px}
</style>
{% endblock %}

{% block content %}
<div class="container" style="max-width:820px">

<h3 class="mb-3">Payout Preferences</h3>

{% if request.query_params.get("saved") %}
<div class="alert alert-success mb-3">
  âœ… Your payout method has been saved successfully.
</div>
{% endif %}

{# ================= SUMMARY CARD ================= #}
{% if payout and not request.query_params.get("edit") %}
<div class="card">
  <h5>Your payout method</h5>

  <p class="mb-1">
    You receive your earnings via
    <strong>{{ payout.method|upper }}</strong>
  </p>

  <p class="hint">
    {{ payout.destination }} <br>
    Currency: {{ payout.currency }}
  </p>

  <div class="d-flex gap-2 mt-3">
    <a href="/payout/settings?edit=1" class="btn btn-outline-primary">
      Edit
    </a>

    <form method="post" action="/payout/settings/remove">
      <button class="btn btn-outline-danger">Remove</button>
    </form>
  </div>
</div>
{% endif %}

{# ================= FORM ================= #}
{% if request.query_params.get("edit") or not payout %}
<form method="post" action="/payout/settings">

<div class="card">
  <p>Choose how you want to receive your <strong>earnings</strong>.</p>
  <p class="hint">Sevor sends payouts manually.</p>
</div>

<div class="card">

  <div class="method active" data-method="interac">
    <div class="method-title">
      <input type="radio" name="method" value="interac" checked>
      Interac e-Transfer (Canada)
    </div>
    <div class="field">
      <input name="interac_destination" placeholder="Email or phone">
    </div>
  </div>

  <div class="method" data-method="paypal">
    <div class="method-title">
      <input type="radio" name="method" value="paypal"> PayPal
    </div>
    <div class="field d-none">
      <input name="paypal_email" placeholder="PayPal email">
    </div>
  </div>

  <div class="method" data-method="wise">
    <div class="method-title">
      <input type="radio" name="method" value="wise"> Wise
    </div>
    <div class="field d-none">
      <input name="wise_iban" placeholder="IBAN">
    </div>
  </div>

</div>

<div class="card">
  <select name="currency">
    <option value="CAD">CAD</option>
    <option value="USD">USD</option>
    <option value="EUR">EUR</option>
  </select>
</div>

<button class="btn btn-primary">Save payout preference</button>
</form>
{% endif %}

</div>
{% endblock %}

{% block scripts %}
<script>
(function(){
  const methods = document.querySelectorAll(".method");
  const radios = document.querySelectorAll("input[name=method]");
  radios.forEach(r => r.addEventListener("change", () => {
    methods.forEach(m => {
      const active = m.dataset.method === r.value;
      m.classList.toggle("active", active);
      m.querySelector(".field")?.classList.toggle("d-none", !active);
    });
  }));
})();
</script>
{% endblock %}
