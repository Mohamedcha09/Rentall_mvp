{% extends "base.html" %}
{% from "_badges.html" import render_badges %}
{% block content %}

<section class="container" style="max-width:960px;margin:auto">

  <!-- رأس الصفحة -->
  <header style="display:flex;align-items:center;gap:16px;margin:18px 0">
    <img src="{{ user.avatar_path or url_for('static', path='placeholder.png') }}"
         alt="avatar"
         style="width:72px;height:72px;border-radius:50%;object-fit:cover;box-shadow:0 0 0 2px rgba(255,255,255,.15)">
    <div>
      <h2 style="margin:0;display:flex;align-items:center;gap:8px">
        {{ user.first_name }} {{ user.last_name }}
        {{ render_badges(badges, 24) }}
      </h2>
      <div class="text-muted small" style="opacity:.8">
        البريد: {{ user.email }} • الهاتف: {{ user.phone or 'غير مضاف' }} •
        عضو منذ: {{ joined_at.strftime('%Y-%m-%d') if joined_at else '' }}
      </div>
    </div>
  </header>

  <!-- بطاقات الإحصائيات -->
  <div class="row g-3 mb-4" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px">
    <div class="card" style="background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:12px">
      <div class="card-body">
        <div class="text-muted small mb-1">إجمالي العناصر</div>
        <div class="h5 mb-0">{{ items_count }}</div>
      </div>
    </div>
    <div class="card" style="background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:12px">
      <div class="card-body">
        <div class="text-muted small mb-1">العناصر النشطة</div>
        <div class="h5 mb-0">{{ items_active_count }}</div>
      </div>
    </div>
    <div class="card" style="background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:12px">
      <div class="card-body">
        <div class="text-muted small mb-1">متوسط التقييم</div>
        <div class="h5 mb-0">{{ '%.1f'|format(avg_stars or 0) }}</div>
      </div>
    </div>
    <div class="card" style="background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:12px">
      <div class="card-body">
        <div class="text-muted small mb-1">عدد التقييمات</div>
        <div class="h5 mb-0">{{ ratings_count }}</div>
      </div>
    </div>
  </div>

  <!-- آخر المراجعات -->
  <div class="card mb-4" style="background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.12);border-radius:12px">
    <div class="card-body">
      <h5 class="mb-3">آخر المراجعات</h5>
      {% if reviews and reviews|length %}
        <div class="list-group">
          {% for r in reviews %}
            <div class="list-group-item bg-transparent text-white border-secondary" style="border-color:rgba(255,255,255,.12)!important">
              <div class="d-flex justify-content-between">
                <strong>{{ r.rater_name }}</strong>
                <small class="text-muted">{{ r.created_at.strftime("%Y-%m-%d") if r.created_at else "" }}</small>
              </div>
              <div class="mb-1">
                {% for i in range(1,6) %}
                  {% if i <= r.stars %}
                    <span style="color:#ffc107">★</span>
                  {% else %}
                    <span style="color:#888">☆</span>
                  {% endif %}
                {% endfor %}
              </div>
              {% if r.comment %}
                <div class="text-body">{{ r.comment }}</div>
              {% else %}
                <div class="text-muted">لا توجد ملاحظة.</div>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-muted">لا توجد تقييمات بعد.</div>
      {% endif %}
    </div>
  </div>

  <!-- عناصر المستخدم (مختصر) -->
  <h5 class="mb-2">عناصري</h5>
  {% if items_count == 0 %}
    <p class="text-muted">لا توجد عناصر بعد.</p>
  {% else %}
    <a class="btn btn-sm btn-outline-light mb-2" href="/owner/items">عرض كل العناصر</a>
  {% endif %}

</section>

{% endblock %}
