{% extends "base.html" %}
{% block content %}
<h2>Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯</h2>
<form method="post" enctype="multipart/form-data">
  <div class="mb-3">
    <label class="form-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
    <input type="text" name="title" class="form-control" required>
  </div>
  <div class="mb-3">
    <label class="form-label">Ø§Ù„ØªØµÙ†ÙŠÙ</label>
    <select class="form-select" name="category" required>
      {% for cat in categories %}
        <option value="{{ cat.key }}">{{ cat.label }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="mb-3">
    <label class="form-label">Ø§Ù„ÙˆØµÙ</label>
    <textarea name="description" class="form-control" rows="4"></textarea>
  </div>
  <div class="row">
    <div class="col-md-6 mb-3">
      <label class="form-label">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
      <input type="text" name="city" class="form-control">
      <!-- âœ… Ø¥Ø¶Ø§ÙØ§Øª Ø¯ÙˆÙ† Ø­Ø°Ù Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚: Ø²Ø± GPS + Ø­Ù‚ÙˆÙ„ Ù…Ø®ÙÙŠØ© -->
      <div class="d-flex gap-2 mt-2">
        <button type="button" id="useMyLocNew" class="btn btn-outline-secondary btn-sm">ğŸ“ Ø§Ø³ØªØ®Ø¯Ù… Ù…ÙˆÙ‚Ø¹ÙŠ</button>
        <input type="number" id="radiusNew" class="form-control form-control-sm" style="max-width:110px" placeholder="km" value="25" min="1">
      </div>
      <small class="text-muted">ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙŠØ¯ÙˆÙŠÙ‹Ø§ØŒ Ø£Ùˆ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ø­ÙØ¸ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ù„Ù„Ø¥Ø¹Ù„Ø§Ù†.</small>
      <input type="hidden" name="latitude" id="latNew">
      <input type="hidden" name="longitude" id="lngNew">
      <!-- /Ø¥Ø¶Ø§ÙØ§Øª -->
    </div>
    <div class="col-md-6 mb-3">
      <label class="form-label">Ø§Ù„Ø³Ø¹Ø±/Ø§Ù„ÙŠÙˆÙ…</label>
      <input type="number" name="price_per_day" class="form-control" value="0" min="0">
    </div>
  </div>
  <div class="mb-3">
    <label class="form-label">ØµÙˆØ±Ø©</label>
    <input type="file" name="image" class="form-control" accept=".jpg,.jpeg,.png">
  </div>
  <button class="btn btn-primary">Ø­ÙØ¸</button>
  <a href="/items" class="btn btn-outline-light">Ø±Ø¬ÙˆØ¹</a>
</form>
{% endblock %}

{# âœ… Ù†Ø¶ÙŠÙ Ø³ÙƒØ±Ø¨Øª Ø¯Ø§Ø®Ù„ block scripts ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø© (base.html ÙŠÙ…Ù„Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù„ÙˆÙƒ) #}
{% block scripts %}
<script>
(function(){
  const btn = document.getElementById('useMyLocNew');
  const latEl = document.getElementById('latNew');
  const lngEl = document.getElementById('lngNew');
  const radEl = document.getElementById('radiusNew');

  function setCookie(name, value, days=180){
    const d=new Date(); d.setTime(d.getTime()+days*864e5);
    document.cookie = name+"="+encodeURIComponent(value||"")+";expires="+d.toUTCString()+";path=/;SameSite=Lax";
  }

  btn?.addEventListener('click', function(){
    if(!navigator.geolocation){
      alert('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹.');
      return;
    }
    const r = radEl?.value || "25";
    navigator.geolocation.getCurrentPosition(function(pos){
      const {latitude, longitude} = pos.coords;
      if (latEl) latEl.value = latitude;
      if (lngEl) lngEl.value = longitude;
      // Ø­ÙØ¸ Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ù„Ù€radius ÙÙŠ Ø§Ù„ÙƒÙˆÙƒÙŠ Ù„ÙŠØ³ØªÙÙŠØ¯ Ù…Ù†Ù‡ Ø§Ù„Ø¨Ø­Ø« Ù„Ø§Ø­Ù‚Ù‹Ø§
      setCookie('radius_km', r);
      alert('ØªÙ… Ø­ÙØ¸ Ù…ÙˆÙ‚Ø¹Ùƒ (Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª) Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ±Ùƒ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙƒÙ…Ø§ Ù‡ÙŠ Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§.');
    }, function(){
      alert('ØªØ¹Ø°Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹Ùƒ. ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙÙ‚Ø·.');
    });
  });
})();
</script>
{% endblock %}