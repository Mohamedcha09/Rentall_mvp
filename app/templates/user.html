{% extends "base.html" %}

{% block head %}
<style>
  /* ØªØ­Ø³ÙŠÙ†Ø§Øª ØµØºÙŠØ±Ø© Ø®Ø§ØµØ© Ø¨ØµÙØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙ‚Ø· */
  .profile-header{position:relative;border-radius:16px;padding:18px;border:1px solid var(--border);background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02))}
  .profile-name{font-weight:800; letter-spacing:.2px}
  .chip{display:inline-flex;align-items:center;gap:.35rem;padding:.2rem .6rem;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.06);font-size:.85rem}
  .chip i{font-size:1rem}
  .chip--verified{background:rgba(85,213,255,.14);border-color:rgba(85,213,255,.35);color:#9be3ff}
  .chip--new{background:rgba(124,92,255,.14);border-color:rgba(124,92,255,.35);color:#d3c8ff}
  .chip--power{background:rgba(34,197,94,.18);border-color:rgba(34,197,94,.35);color:#86efac}
  .chip--trusted{background:rgba(250,204,21,.18);border-color:rgba(250,204,21,.35);color:#fde68a}
  .chip--top{background:rgba(253,164,175,.18);border-color:rgba(253,164,175,.35);color:#fecdd3}
  .stat{display:inline-flex;align-items:center;gap:.45rem;padding:.35rem .6rem;border-radius:10px;border:1px solid var(--border);background:rgba(255,255,255,.04)}
  .avatar-lg{width:84px;height:84px;border-radius:50%;object-fit:cover;border:1px solid var(--border)}
  .tab-content > .tab-pane{padding-top:14px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:14px}
  .card.item{height:100%;display:flex;flex-direction:column}
  .item-img{height:160px;object-fit:cover;border-bottom:1px solid var(--border)}
  .item-body{flex:1;display:flex;flex-direction:column;gap:.5rem;padding:.75rem}
  .rating-stars{color:#ffd166}
</style>
{% endblock %}

{% block content %}

<section class="profile-header mb-3">
  <div class="d-flex align-items-center justify-content-between gap-3 flex-wrap">
    <div class="d-flex align-items-center gap-3 flex-wrap">
      <!-- Ø§Ù„ØµÙˆØ±Ø© -->
      {% if user.avatar_path %}
        <img src="/{{ user.avatar_path }}" class="avatar-lg" alt="avatar">
      {% else %}
        <div class="avatar-lg d-inline-grid place-items-center" style="display:grid;place-items:center;background:rgba(255,255,255,.06)">
          <i class="bi bi-person" style="font-size:2rem;opacity:.8"></i>
        </div>
      {% endif %}

      <div>
        <!-- Ø§Ù„Ø§Ø³Ù… + Ø§Ù„Ø´Ø§Ø±Ø§Øª -->
        <div class="d-flex align-items-center flex-wrap gap-2">
          <h1 class="h3 m-0 profile-name">
            {{ (user.first_name~' '~user.last_name)|trim or 'Ù…Ø³ØªØ®Ø¯Ù…' }}
          </h1>

          {# Ø´Ø§Ø±Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ #}
          {% if badges.verified %}
            <span class="chip chip--verified" title="Ù…ÙˆØ«Ù‘Ù‚">
              <i class="bi bi-patch-check-fill"></i> Ù…ÙˆØ«Ù‘Ù‚
            </span>
          {% endif %}

          {# Ø¬Ø¯ÙŠØ¯ #}
          {% if badges.new_user %}
            <span class="chip chip--new" title="Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯">
              <i class="bi bi-stars"></i> Ø¬Ø¯ÙŠØ¯
            </span>
          {% endif %}

          {# Ø¨Ø§Ø¦Ø¹ Ù‚ÙˆÙŠ #}
          {% if badges.power_seller %}
            <span class="chip chip--power" title="Ø¨Ø§Ø¦Ø¹ Ù‚ÙˆÙŠ">
              <i class="bi bi-lightning-charge-fill"></i> Ø¨Ø§Ø¦Ø¹ Ù‚ÙˆÙŠ
            </span>
          {% endif %}

          {# Ù…ÙˆØ«ÙˆÙ‚ #}
          {% if badges.trusted %}
            <span class="chip chip--trusted" title="Ù…ÙˆØ«ÙˆÙ‚">
              <i class="bi bi-shield-check"></i> Ù…ÙˆØ«ÙˆÙ‚
            </span>
          {% endif %}

          {# Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Ù‹ #}
          {% if badges.top_rated %}
            <span class="chip chip--top" title="Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Ù‹">
              <i class="bi bi-star-fill"></i> Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Ù‹
            </span>
          {% endif %}
        </div>

        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØµØºÙŠØ±Ø© ØªØ­Øª Ø§Ù„Ø§Ø³Ù… -->
        <div class="mt-2 d-flex align-items-center gap-2 flex-wrap">
          <span class="stat" title="Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ±">
            <i class="bi bi-box-seam"></i> {{ items_count }} Ø¹Ù†ØµØ±
          </span>

          <span class="stat" title="Ø­Ø¬ÙˆØ²Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©">
            <i class="bi bi-check2-circle"></i> {{ completed_rentals }} Ø­Ø¬Ø² Ù…ÙƒØªÙ…Ù„
          </span>

          <span class="stat" title="Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…">
            <i class="bi bi-star-fill rating-stars"></i>
            {{ (avg_rating if avg_rating is not none else '0.0') }} / 5
          </span>

          {% if user.created_at %}
          <span class="stat" title="ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…">
            <i class="bi bi-calendar-check"></i>
            Ø§Ù†Ø¶Ù… {{ user.created_at.strftime('%d-%m-%Y') }}
          </span>
          {% endif %}

          {% if user.city %}
          <span class="stat" title="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©">
            <i class="bi bi-geo-alt"></i> {{ user.city }}
          </span>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Ø²Ø± Ù…Ø±Ø§Ø³Ù„Ø© / Ø¥Ø¬Ø±Ø§Ø¡ -->
    <div class="d-flex align-items-center gap-2">
      <a href="/messages/new?to={{ user.id }}" class="btn btn-primary">
        <i class="bi bi-chat-dots"></i> ØªÙˆØ§ØµÙ„
      </a>
    </div>
  </div>
</section>

<!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª: Ø§Ù„Ø¹Ù†Ø§ØµØ± / Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª / Ø­ÙˆÙ„ -->
<ul class="nav nav-pills gap-2" id="profileTabs" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="items-tab" data-bs-toggle="tab" data-bs-target="#items" type="button" role="tab">
      Ø§Ù„Ø¹Ù†Ø§ØµØ±
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button" role="tab">
      Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="about-tab" data-bs-toggle="tab" data-bs-target="#about" type="button" role="tab">
      Ø­ÙˆÙ„
    </button>
  </li>
</ul>

<div class="tab-content">
  <!-- Ø§Ù„Ø¹Ù†Ø§ØµØ± -->
  <div class="tab-pane fade show active" id="items" role="tabpanel" aria-labelledby="items-tab">
    {% if items|length == 0 %}
      <div class="card p-4 text-center text-muted mt-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….</div>
    {% else %}
      <div class="grid mt-2">
        {% for it in items %}
        <article class="card item">
          {% if it.image_path %}
            <img src="/{{ it.image_path }}" class="item-img" alt="item">
          {% else %}
            <img src="/static/img/placeholder.jpg" class="item-img" alt="">
          {% endif %}
          <div class="item-body">
            <h6 class="mb-1 text-truncate" title="{{ it.title }}">{{ it.title }}</h6>
            <div class="small text-muted d-flex align-items-center justify-content-between">
              <span>ğŸ™ï¸ {{ it.city or 'Ø¨Ø¯ÙˆÙ† Ù…Ø¯ÙŠÙ†Ø©' }}</span>
              <span><strong>{{ it.price_per_day or 0 }}</strong> <span class="text-muted">Ø¯/ÙŠÙˆÙ…</span></span>
            </div>
            <div class="mt-2 d-flex align-items-center justify-content-between">
              <span class="badge bg-secondary">{{ it.category_label or 'Ø£Ø®Ø±Ù‰' }}</span>
              <a class="btn btn-sm btn-primary" href="/items/{{ it.id }}">ØªÙØ§ØµÙŠÙ„</a>
            </div>
          </div>
        </article>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  <!-- Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª -->
  <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
    {% if reviews|length == 0 %}
      <div class="card p-4 text-center text-muted mt-2">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</div>
    {% else %}
      <div class="vstack gap-2 mt-2">
        {% for r in reviews %}
          <div class="card p-3">
            <div class="d-flex align-items-center justify-content-between">
              <div class="small text-muted">
                {% set nm = (r.reviewer_first ~ ' ' ~ r.reviewer_last)|trim %}
                <i class="bi bi-person-circle"></i> {{ nm or 'Ù…Ø³ØªØ®Ø¯Ù…' }}
              </div>
              <div class="rating-stars" title="{{ r.rating }}/5">
                {% for i in range(1,6) %}
                  {% if i <= (r.rating or 0) %}<i class="bi bi-star-fill"></i>{% else %}<i class="bi bi-star"></i>{% endif %}
                {% endfor %}
              </div>
            </div>
            {% if r.comment %}
              <div class="mt-2">{{ r.comment }}</div>
            {% endif %}
            {% if r.created_at %}
              <div class="small text-muted mt-2"><i class="bi bi-clock"></i> {{ r.created_at.strftime('%Y-%m-%d') }}</div>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  <!-- Ø­ÙˆÙ„ -->
  <div class="tab-pane fade" id="about" role="tabpanel" aria-labelledby="about-tab">
    <div class="card p-3 mt-2">
      <h6 class="mb-2">Ù†Ø¨Ø°Ø©</h6>
      <p class="mb-0">{{ user.bio or 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø¨Ø°Ø©.' }}</p>
    </div>
  </div>
</div>

{% endblock %}
