{% extends "base.html" %}

{% block content %}

<!-- En-tÃªte profil avec badges -->
<section class="card p-3 p-md-4 mb-3 glass">
  <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">

    <div class="d-flex align-items-center gap-3">
      {% if user.avatar_path %}
        <img src="/{{ user.avatar_path }}" class="avatar-xl rounded-circle border" alt="avatar">
      {% else %}
        <div class="avatar-xl rounded-circle border d-grid place-items-center fw-bold">
          {{ (user.first_name or 'U')[:1] }}
        </div>
      {% endif %}

      <div>
        <h2 class="m-0 d-flex align-items-center gap-2">
          {{ user.first_name }} {{ user.last_name }}

          {# Badges dynamiques #}
          {% if badges.verified %}
            <span class="badge badge-chip chip-verified">
              <i class="bi bi-patch-check-fill me-1"></i>Ù…ÙˆØ«Ù‘Ù‚
            </span>
          {% endif %}
          {% if badges.new_user %}
            <span class="badge badge-chip chip-new">
              <i class="bi bi-stars me-1"></i>Ø¬Ø¯ÙŠØ¯
            </span>
          {% endif %}
          {% if badges.power_seller %}
            <span class="badge badge-chip chip-power">
              <i class="bi bi-lightning-charge-fill me-1"></i>ØªØ§Ø¬Ø± Ù†Ø´ÙØ·
            </span>
          {% endif %}
          {% if badges.trusted %}
            <span class="badge badge-chip chip-trusted">
              <i class="bi bi-shield-check me-1"></i>Ù…ÙˆØ«ÙˆÙ‚
            </span>
          {% endif %}
          {% if badges.top_rated %}
            <span class="badge badge-chip chip-top">
              <i class="bi bi-star-fill me-1"></i>ØªÙ‚ÙŠÙŠÙ… Ù…Ù…ØªØ§Ø²
            </span>
          {% endif %}
        </h2>

        <div class="text-muted small mt-1 d-flex flex-wrap align-items-center gap-3">
          <span><i class="bi bi-box-seam me-1"></i> Ø¹Ù†Ø§ØµØ±: {{ items_count }}</span>
          <span><i class="bi bi-hand-thumbs-up me-1"></i> ØªØ£Ø¬ÙŠØ±Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©: {{ completed_rentals }}</span>
          <span><i class="bi bi-star me-1"></i> Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: {{ avg_rating if avg_rating is not none else 'â€”' }}</span>
          <span><i class="bi bi-calendar2-check me-1"></i>
            Ø§Ù†Ø¶Ù…: {{ user.created_at.strftime("%Y-%m-%d") if user.created_at else '' }}
          </span>
        </div>
      </div>
    </div>

    <div class="ms-auto">
      <a class="btn btn-primary" href="/messages/new?to={{ user.id }}">
        <i class="bi bi-chat-dots"></i> ØªÙˆØ§ØµÙ„
      </a>
    </div>

  </div>
</section>

<!-- Onglets -->
<ul class="nav nav-pills glass mb-3 p-1 gap-1" role="tablist">
  <li class="nav-item">
    <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-items" type="button" role="tab">
      Ø§Ù„Ø¹Ù†Ø§ØµØ±
    </button>
  </li>
  <li class="nav-item">
    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-reviews" type="button" role="tab">
      Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
    </button>
  </li>
  <li class="nav-item">
    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-about" type="button" role="tab">
      Ø­ÙˆÙ„
    </button>
  </li>
</ul>

<div class="tab-content">

  <!-- Tab: Items -->
  <div class="tab-pane fade show active" id="tab-items" role="tabpanel">
    <div class="home-grid">
      {% for it in items %}
        <article class="card spot">
          <div class="spot-media">
            {% if it.image_path %}
              <img src="/{{ it.image_path }}" alt="item">
            {% else %}
              <div class="spot-placeholder d-grid place-items-center w-100 h-100">Ù„Ø§ ØµÙˆØ±Ø©</div>
            {% endif %}
            <div class="price-badge"><strong>{{ it.price_per_day }}</strong><span> Ø¯/ÙŠÙˆÙ…</span></div>
            <div class="category-chip">{{ it.category_label }}</div>
          </div>

          <div class="card-body">
            <h6 class="spot-title" title="{{ it.title }}">{{ it.title }}</h6>
            <div class="d-flex align-items-center justify-content-between">
              <div class="small city-chip" title="{{ it.city or '' }}">ğŸ™ï¸ {{ it.city or 'Ø¨Ø¯ÙˆÙ† Ù…Ø¯ÙŠÙ†Ø©' }}</div>
              <a href="/items/{{ it.id }}" class="btn btn-sm btn-primary">ØªÙØ§ØµÙŠÙ„</a>
            </div>
          </div>
        </article>
      {% else %}
        <div class="text-muted">Ù„Ø§ Ø¹Ù†Ø§ØµØ± Ø¨Ø¹Ø¯.</div>
      {% endfor %}
    </div>
  </div>

  <!-- Tab: Reviews -->
  <div class="tab-pane fade" id="tab-reviews" role="tabpanel">
    {% if reviews and reviews|length > 0 %}
      <div class="vstack gap-2">
        {% for r in reviews %}
          <div class="card p-2">
            <div class="small text-muted">
              {{ r.created_at.strftime("%Y-%m-%d") if r.created_at else '' }}
            </div>
            <div class="fw-bold d-flex align-items-center gap-2">
              {{ r.reviewer_first }} {{ r.reviewer_last }}
              <span class="text-warning">
                {% for i in range(1,6) %}
                  <i class="bi {% if i <= (r.rating or 0) %}bi-star-fill{% else %}bi-star{% endif %}"></i>
                {% endfor %}
              </span>
            </div>
            <div>{{ r.comment }}</div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="text-muted">Ù„Ø§ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</div>
    {% endif %}
  </div>

  <!-- Tab: About -->
  <div class="tab-pane fade" id="tab-about" role="tabpanel">
    <div class="card p-3">
      <div class="fw-bold mb-1">Ù†Ø¨Ø°Ø©</div>
      <div class="text-muted">{{ user.bio or 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø¨Ø°Ø©.' }}</div>
    </div>
  </div>

</div>

{% endblock %}
