{# app/templates/item_show.html #}
{% extends "base.html" %}
{% from "_badges.html" import render_badges %}
{% block content %}

<style>
/* ====== Base (Desktop) ====== */
:root{
  --bg-1:#0b1220; --bg-2:#0f172a; --card:#0f172acc;
  --stroke:rgba(255,255,255,.12); --stroke-soft:rgba(255,255,255,.08);
  --txt:#eaf0ff; --muted:#9fb0d8; --brand:#3b82f6; --ok:#10b981;
  --glass:rgba(255,255,255,.06);
  --shadow:0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.04);
}
.items-shell{max-width:1100px;margin:18px auto;padding:0 12px}
.grid-2{display:grid;gap:18px;grid-template-columns:1.2fr .8fr}
@media (max-width:920px){.grid-2{grid-template-columns:1fr}}
.card-glass{background:linear-gradient(180deg,var(--glass),transparent);border:1px solid var(--stroke);border-radius:16px;overflow:hidden;backdrop-filter:blur(8px);box-shadow:var(--shadow)}
.card-body{padding:18px}
.card-title{margin:0 0 8px 0;font-weight:800;letter-spacing:.2px}
.small-muted{color:var(--muted);font-size:13px}
.badge-pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid var(--stroke);background:rgba(255,255,255,.05);font-size:12px;color:var(--muted)}
.gallery{background:#0c1324;border-bottom:1px solid var(--stroke-soft)}
.gallery-main{position:relative;aspect-ratio:16/10;width:100%;background:#0a0f1e;overflow:hidden}
.gallery-main img{width:100%;height:100%;object-fit:cover;display:block;transform-origin:center}
.gallery-zoom{position:absolute;bottom:10px;right:10px;background:rgba(0,0,0,.45);border:1px solid var(--stroke);border-radius:12px;padding:8px 12px;font-size:13px;color:#fff;cursor:pointer;backdrop-filter:blur(6px)}
.gallery-menu{position:absolute;top:10px;right:10px}
.gallery-menu .btn-menu{background:rgba(0,0,0,.45);color:#fff;border:1px solid var(--stroke);border-radius:12px;padding:6px 10px;line-height:1;font-weight:700}
.gallery-menu .dropdown-menu{border-radius:12px;overflow:hidden;border:1px solid var(--stroke)}
.thumbs{display:flex;gap:10px;padding:12px;overflow-x:auto;background:linear-gradient(180deg,rgba(255,255,255,.03),transparent);scroll-snap-type:x mandatory}
.thumbs img{width:86px;height:60px;object-fit:cover;border-radius:10px;border:1px solid var(--stroke-soft);cursor:pointer;opacity:.85;transition:transform .15s ease,opacity .15s ease,box-shadow .15s ease;scroll-snap-align:center}
.thumbs img:hover{transform:translateY(-2px);opacity:1;box-shadow:0 4px 14px rgba(0,0,0,.25)}
.thumbs img.active{outline:2px solid var(--brand);opacity:1}
.btnx{display:inline-flex;align-items:center;gap:8px;padding:10px 16px;border-radius:12px;font-weight:700;text-decoration:none;cursor:pointer;user-select:none;border:1px solid var(--stroke);backdrop-filter:blur(8px);background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.02));color:var(--txt);transition:transform .12s ease,background .2s ease,border-color .2s ease}
.btnx:hover{transform:translateY(-1px);border-color:rgba(255,255,255,.2)}
.btnx-primary{border-color:rgba(59,130,246,.6);background:linear-gradient(180deg,rgba(59,130,246,.35),rgba(59,130,246,.1))}
.btnx-green{border-color:rgba(16,185,129,.6);background:linear-gradient(180deg,rgba(16,185,129,.35),rgba(16,185,129,.1))}
.btnx-ghost{border-color:var(--stroke);background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02))}
.btns-row{display:flex;flex-wrap:wrap;gap:10px}
.lightbox{position:fixed;inset:0;display:none;place-items:center;z-index:9999;background:rgba(0,0,0,.8)}
.lightbox.show{display:grid}
.lightbox img{max-width:92vw;max-height:88vh;border-radius:14px;border:1px solid var(--stroke)}
.lightbox .close{position:absolute;top:18px;right:18px;background:rgba(0,0,0,.6);border:1px solid var(--stroke);color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer}
.owner-row{display:flex;align-items:center;gap:12px}
.owner-avatar{width:62px;height:62px;border-radius:50%;object-fit:cover;box-shadow:0 0 0 2px var(--stroke)}
.hr{border:0;height:1px;background:var(--stroke-soft);margin:14px 0}

/* ====== Mobile + Airbnb look ====== */
@media (max-width:768px){
  body{background:#fff;color:#111}
  .items-shell{padding:0;margin:0;max-width:none}
  .grid-2{display:block}

  /* --- Parallax Hero --- */
  .gallery{background:#fff;border:0}
  .gallery-main{height:58vh;max-height:520px;border-radius:0}
  .gallery-main img{object-fit:cover;will-change:transform,opacity}
  .hero-fade{
    position:absolute;inset:0;pointer-events:none;
    background:linear-gradient(to bottom, rgba(0,0,0,0) 40%, rgba(0,0,0,.05) 58%, rgba(255,255,255,1) 100%);
    opacity:.0;transition:opacity .25s ease;
  }

  /* FABs + Counter */
  .air-fab,.air-fab-right .air-fab{
    appearance:none;border:0;cursor:pointer;width:44px;height:44px;border-radius:50%;
    background:rgba(255,255,255,.9);box-shadow:0 8px 20px rgba(0,0,0,.18);
    display:grid;place-items:center;font-size:18px;line-height:1
  }
  .air-fab{position:absolute;top:16px;left:12px}
  .air-fab-right{position:absolute;top:16px;right:12px;display:flex;gap:10px}

  /* ===== ADD: Ø­Ø§ÙˆÙŠØ© Ø§Ù„ÙŠØ³Ø§Ø± Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ (Ø³Ù‡Ù… Ø§Ù„Ø±Ø¬ÙˆØ¹) ===== */
  .air-fab-left{position:absolute;left:12px;display:flex;gap:10px;
    top:calc(8px + env(safe-area-inset-top, 0px)); z-index:10001;}
  .air-fab-right{top:calc(8px + env(safe-area-inset-top, 0px)); z-index:10001;}

  .air-pager{position:absolute;bottom:12px;right:12px;background:rgba(0,0,0,.55);color:#fff;font-weight:600;padding:6px 10px;border-radius:10px;font-size:12px;border:1px solid rgba(255,255,255,.25)}

  /* Ø§Ù„ÙˆØ±Ù‚Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ Ø§Ù„Ù…Ù†Ø­Ù†ÙŠØ© + Ø­Ø¯ Ù†Ø§Ø¹Ù… */
  .card-glass{background:transparent;border:0;box-shadow:none}
  .air-sheet{
    background:#fff;color:#111;margin-top:-24px;
    border-top-left-radius:28px;border-top-right-radius:28px;
    padding:22px 18px 120px;
    box-shadow:0 -6px 20px rgba(0,0,0,.06);border:1px solid #eee;border-bottom:0;position:relative;
  }
  .air-sheet::before{
    content:"";position:absolute;top:0;left:0;right:0;height:14px;border-top-left-radius:28px;border-top-right-radius:28px;
    background:linear-gradient(to bottom, rgba(0,0,0,.06), rgba(0,0,0,0));
    opacity:.35;pointer-events:none
  }

  /* Typography */
  .card-title{font-size:28px;font-weight:800;margin-bottom:6px;color:#111;letter-spacing:.2px}
  .small-muted{color:#717171!important;font-size:14px;line-height:1.5}
  .hr{background:#e5e7eb}

  /* ======= Fixed Bottom Booking Bar ======= */
  .air-fixed{
    position:fixed !important; left:0; right:0; bottom:0;
    z-index:10000;
    background:#fff !important;
    border-top:1px solid #eee;
    padding:12px 16px calc(12px + env(safe-area-inset-bottom,0px));
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    box-shadow:0 -6px 18px rgba(0,0,0,.08);
  }
  .air-underlay{
    position:fixed; left:0; right:0; bottom:0;
    height:calc(18px + env(safe-area-inset-bottom,0px));
    background:#fff;
    z-index:9999;
    pointer-events:none;
  }

  .air-price{display:flex;flex-direction:column;line-height:1.2}
  .air-price .now{font-weight:800;font-size:20px}
  .air-price .per{color:#717171;font-size:12px}
  .air-cta{
    flex:0 0 auto;min-width:150px;text-align:center;height:48px;line-height:48px;padding:0 20px;border-radius:14px;
    font-weight:700;color:#fff;background:linear-gradient(90deg,#ff385c,#e61e4d);border:0;text-decoration:none;display:inline-block
  }

  /* Laurel */
  .laurel-row{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:8px 0 12px 0}
  .laurel-mid{display:flex;align-items:center;gap:10px;flex:1;justify-content:center}
  .laurel{height:20px;width:auto;opacity:.95}
  .score{font-weight:800;font-size:18px;color:#111;display:flex;align-items:center;gap:6px}
  .score small{color:#6b7280;font-weight:600}

  /* Reviews */
  .rv-strip{display:flex;gap:14px;overflow-x:auto;scroll-snap-type:x mandatory;padding:2px 2px 12px 2px}
  .rv-card{scroll-snap-align:start;flex:0 0 84vw;background:#fff;border:1px solid #eee;border-radius:16px;padding:14px;box-shadow:0 6px 14px rgba(0,0,0,.05)}
  .rv-head{display:flex;align-items:center;gap:10px;margin-bottom:6px}
  .rv-ava{width:40px;height:40px;border-radius:50%;object-fit:cover}
  .rv-meta{color:#6b7280;font-size:12px}
  .rv-stars{font-size:13px}
  .rv-stars .full{color:#111}
  .rv-stars .empty{color:#bdbdbd}
  .rv-more{display:inline-block;margin-top:4px;font-weight:600}
  .btn-outline-pale{display:block;width:100%;text-align:center;border:1px solid #e5e7eb;background:#fff;border-radius:999px;padding:10px 14px;font-weight:700}

  .offcanvas-bottom{border-top-left-radius:18px;border-top-right-radius:18px}
}

/* Ù†Ø¬ÙˆÙ… Ø£Ø¨ÙŠØ¶/Ø±Ù…Ø§Ø¯ÙŠ Ø¹Ø§Ù…Ø© â€” Ø³Ø·ÙˆØ± Ù…ÙˆØ­Ù‘Ø¯Ø© Ù„ÙƒÙ„ Ø§Ù„Ù†Ø¬ÙˆÙ… */
.stars-bw{
  display:inline-flex;
  gap:4px;
  font-size:16px;
  line-height:1;
  letter-spacing:0;
}
.stars-bw span{
  display:inline-block;
  width:1em;
  text-align:center;
}
.stars-bw .full{color:#111}
.stars-bw .empty{color:#bdbdbd}

/* Ù…Ø³Ø§Ø§ÙØ§Øª Ù…ØªØ³Ø§ÙˆÙŠØ© Ù„Ù†Ø¬ÙˆÙ… Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª */
.rv-stars{
  display:inline-flex;
  gap:4px;
  font-size:16px;
  line-height:1;
  letter-spacing:0;
}
.rv-stars span{
  display:inline-block;
  width:1em;
  text-align:center;
}
.rv-stars .full{color:#111}
.rv-stars .empty{color:#bdbdbd}

/* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙØ±Ø§Øº Ø§Ù„Ø¹Ù„ÙˆÙŠ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ù…Ù†Ø´ÙˆØ± */
@media (max-width:768px){
  body.item-page{
    margin-top:0 !important;
    padding-top:0 !important;
  }
  .items-shell{ margin-top:0 !important; }

  /* Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰ Ø­ØªÙ‰ ØªÙ„Ù…Ø³ Ø§Ù„Ø­Ø§ÙØ© */
  .gallery{
    margin-top:calc(-1 * env(safe-area-inset-top, 0px));
  }
  .gallery-main{
    height:calc(58vh + env(safe-area-inset-top, 0px));
  }

  /* ØªØ£Ù…ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù…Ù† Ø§Ù„Ù†ÙˆØªØ´ */
  .air-fab{ top:calc(8px + env(safe-area-inset-top, 0px)); }
  .air-fab-right{ top:calc(8px + env(safe-area-inset-top, 0px)); }
}

/* ===== Ø¥ØµÙ„Ø§Ø­ Ø£Ø¹Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ ÙÙ‚Ø· ===== */
@media (max-width:768px){
  html, body.item-page{ 
    background:#fff !important;
    margin:0 !important;
    padding:0 !important;
  }
  body.item-page .items-shell{ 
    margin-top:0 !important; 
    padding-top:0 !important;
  }
  body.item-page .gallery{
    background:#fff !important;
    border:0 !important;
    margin-top:calc(-1 * env(safe-area-inset-top, 0px)) !important;
  }
  body.item-page .gallery-main{
    border-radius:0 !important;
    height:calc(58vh + env(safe-area-inset-top, 0px)) !important;
    padding-top:env(safe-area-inset-top, 0px) !important;
  }

  /* Ø£Ø®ÙÙ Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ÙÙ‚Ø· Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¹Ø±Ø¶ */
  body.item-page .gallery > .air-fab{ 
    display:none !important; 
  }
  /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙŠÙ…ÙŠÙ† ØªØ¨Ù‚Ù‰ Ø£Ø³ÙÙ„ Ø§Ù„Ù†ÙˆØªØ´ */
  body.item-page .air-fab-right{ 
    top:calc(8px + env(safe-area-inset-top, 0px)) !important; 
  }
}

@media (max-width:768px){
  body.item-page [class^="pt-"], 
  body.item-page [class*=" pt-"],
  body.item-page [class^="mt-"], 
  body.item-page [class*=" mt-"]{
    padding-top:0 !important;
    margin-top:0 !important;
  }
}
</style>

<!-- === Ø¥Ø¶Ø§ÙØ© Ø®ÙÙŠÙØ© Ø£Ø³ÙÙ„ Ø§Ù„Ù…Ù„Ù (Ù…ÙƒØ±Ù‘Ø±Ø© Ù„Ø¯Ø¹Ù… Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©) === -->
<style>
@media (max-width:768px){
  body.item-page{ margin-top:0!important; padding-top:0!important; }
  body.item-page .items-shell{ margin-top:0!important; padding-top:0!important; }
  body.item-page .gallery{
    margin-top:calc(-1 * env(safe-area-inset-top,0px)) !important;
    border-top:0 !important;
    padding-top:0 !important;
  }
  body.item-page .gallery-main{
    height:calc(58vh + env(safe-area-inset-top,0px)) !important;
    border-radius:0 !important;
  }
  body.item-page .gallery > .air-fab{ display:none !important; }
  body.item-page .air-fab-right{
    top:calc(8px + env(safe-area-inset-top,0px)) !important;
  }
}
/* Ø¯Ø¹Ù… iOS Ø§Ù„Ø£Ù‚Ø¯Ù… (constant) */
@media (max-width:768px){
  body.item-page .gallery{
    margin-top:calc(-1 * constant(safe-area-inset-top,0px)) !important;
  }
  body.item-page .gallery-main{
    height:calc(58vh + constant(safe-area-inset-top,0px)) !important;
  }
}
/* ========= FINAL TOP FIX (item page only) ========= */
@media (max-width:768px){
  body.item-page header,
  body.item-page .navbar,
  body.item-page #topbar,
  body.item-page .site-header{
    display:none !important;
  }
  body.item-page main,
  body.item-page .content,
  body.item-page .items-shell{
    margin-top:0 !important;
    padding-top:0 !important;
  }
  body.item-page .gallery{
    background:#fff !important;
    border:0 !important;
    margin-top:calc(-1 * env(safe-area-inset-top, 0px)) !important;
  }
  body.item-page .gallery-main{
    border-radius:0 !important;
    height:calc(58vh + env(safe-area-inset-top, 0px)) !important;
    padding-top:env(safe-area-inset-top, 0px) !important;
  }
  /* Ø£Ø®ÙØ§Ø¡ Ø§Ù„Ø·ÙÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ÙÙ‚Ø· ÙƒÙ…Ø§ Ø³Ø¨Ù‚ */
  body.item-page .gallery > .air-fab{ display:none !important; }
  body.item-page .air-fab-right .air-fab{
  display:grid !important;
}

  html, body.item-page{
    background:#fff !important;
    margin:0 !important;
    padding:0 !important;
    overscroll-behavior-y: none;
  }
}

/* ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨Ø³ÙŠØ·Ø© Ù„Ù„Ù‚Ù„Ø¨ Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ (ÙƒÙ…Ø§ Ù‡ÙŠ) */
.air-fab.is-on { background: rgba(255,255,255,.95); }
.air-fab.is-on i { filter: drop-shadow(0 1px 2px rgba(0,0,0,.15)); }
@keyframes fav-pop { 0%{transform:scale(1)} 40%{transform:scale(1.25)} 100%{transform:scale(1)} }
.air-fab.fav-anim { animation: fav-pop .25s ease; }

/* ===== ADD: Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ù„Ø§Øº Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø© (Ù…ÙˆØ¨Ø§ÙŠÙ„) ===== */
@media (max-width:768px){
  .air-report-bottom{
    margin:14px 0 0 0;
    padding:8px 16px calc(18px + env(safe-area-inset-bottom,0px));
    text-align:center;
  }
  .air-report-link{
    font-weight:700;
    text-decoration:underline;
    color:#111;
  }
}
</style>

<style>
@media (max-width:768px){
  /* Ø§Ø®ÙÙ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø«Ù„Ø§Ø« Ù†Ù‚Ø§Ø· ÙƒÙ„ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
  .gallery-menu{ display:none !important; }

  /* ØªØ£ÙƒÙŠØ¯ Ø¸Ù‡ÙˆØ± Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙŠÙ…ÙŠÙ† ÙÙˆÙ‚ Ø§Ù„ØµÙˆØ±Ø© */
  .air-fab-right{ 
    display:flex !important;
    top:calc(8px + env(safe-area-inset-top,0px));
    right:12px; z-index:10002;
  }
}
</style>

<style>
@media (max-width:768px){
  .offcanvas-top{
    border-bottom-left-radius:18px;
    border-bottom-right-radius:18px;
    padding-top:calc(8px + env(safe-area-inset-top,0px));
  }
}

@media (max-width:768px){
  .offcanvas-top{
    border-bottom-left-radius:18px;
    border-bottom-right-radius:18px;

    /* Ø§Ø­ØªØ±Ø§Ù… Ø§Ù„Ù†ÙˆØªØ´ */
    padding-top:calc(10px + env(safe-area-inset-top,0px));

    /* Ù…Ù‡Ù…: Ø­Ø³Ø§Ø¨ Ø§Ø±ØªÙØ§Ø¹ Ø´Ø±ÙŠØ· Contact Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ */
    padding-bottom:calc(14px + var(--airbar-h, 80px) + env(safe-area-inset-bottom,0px));

    /* Ø§Ø¬Ø¹Ù„ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø¹Ù…Ù„ÙŠÙ‹Ø§ ÙƒØ§Ù…Ù„ Ø§Ù„Ø´Ø§Ø´Ø© */
    height:auto;
    max-height:calc(100dvh - env(safe-area-inset-top,0px));
    overscroll-behavior:contain;
  }
  .offcanvas-top.show{ transform:none; }
  .offcanvas-top{ --bs-offcanvas-height: calc(100dvh - env(safe-area-inset-top,0px)); }
}

@media (max-width:768px){
  .air-fab-left{
    position:absolute; left:12px; display:flex; gap:10px;
    top:calc(8px + env(safe-area-inset-top,0px)); z-index:10001;
  }
  .air-fab-right{
    position:absolute; right:12px; display:flex; gap:10px;
    top:calc(8px + env(safe-area-inset-top,0px)); z-index:10002;
  }
}

</style>

<style>
@media (max-width:768px){
  /* ØªØ£ÙƒÙŠØ¯ Ø¸Ù‡ÙˆØ± Ø§Ù„Ø­Ø§ÙˆÙŠØ© ÙŠÙ…ÙŠÙ† Ø§Ù„ØµÙˆØ±Ø© */
  .air-fab-right{
    position:absolute !important;
    top:calc(8px + env(safe-area-inset-top,0px)) !important;
    right:12px !important;
    display:flex !important;
    gap:10px;
    z-index:10020 !important; /* Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø£ÙŠ Ø¹Ù†Ø§ØµØ± Ø£Ø®Ø±Ù‰ */
  }
  /* ØªØ£ÙƒÙŠØ¯ Ø¸Ù‡ÙˆØ± Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù†ÙØ³Ù‡Ø§ */
  .air-fab-right .air-fab{
    display:grid !important;
    opacity:1 !important;
    visibility:visible !important;
    z-index:10021 !important;
  }
  /* ÙÙŠ Ø­Ø§Ù„ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£ÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø¹Ø§Ù…Ø© ÙƒØ§Ù†Øª ØªØ®ÙÙŠ ÙƒÙ„ .air-fab Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
  .air-fab{ display:grid; }
}
</style>
<style>
@media (max-width:768px){
  /* Ø£Ø®ÙÙ Ø£ÙŠ Ø²Ø± Ø±Ø¬ÙˆØ¹ Ø¹Ø§Ù… ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± Ø¹Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ù…Ù†Ø´ÙˆØ± */
  body.item-page .btn-back,
  body.item-page .back-button,
  body.item-page .nav-back,
  body.item-page .header-back,
  body.item-page header .air-fab,
  body.item-page .navbar .air-fab {
    display:none !important;
  }

  /* Ø£Ø¨Ù‚Ù Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø§Ù„Ø£Ø¨ÙŠØ¶ Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø¹Ø±Ø¶ ÙÙ‚Ø· */
  .air-fab-left .air-fab{
    display:grid !important;
    z-index:10022 !important;
  }

  /* ÙˆÙ„Ùˆ ÙˆÙØ¬Ø¯ Ø²Ø± .air-fab ÙƒØ§Ø¨Ù† Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ù€ .gallery (Ø§Ù„Ø£Ø³ÙˆØ¯) Ø§Ø®ÙÙ‡ */
  .gallery > .air-fab{ display:none !important; }
}
</style>

<style>
/* ===== Mobile hard-override ===== */
@media (max-width:768px){
  /* Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§ÙˆÙŠØªÙŠÙ† ÙˆØ«Ù‚Ù„Ù‡Ù…Ø§ ÙÙˆÙ‚ ÙƒÙ„ Ø´ÙŠØ¡ */
  .air-fab-left,
  .air-fab-right{
    position:absolute !important;
    top:calc(8px + env(safe-area-inset-top,0px)) !important;
    z-index:10050 !important;
  }
  .air-fab-left{ left:12px !important; display:flex !important; gap:10px !important; }
  .air-fab-right{ right:12px !important; display:flex !important; gap:10px !important; }

  /* Ø´ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ¥Ø¬Ø¨Ø§Ø± Ø¸Ù‡ÙˆØ±Ù‡Ø§ */
  .air-fab,
  .air-fab-right .air-fab,
  .air-fab-left .air-fab{
    display:grid !important;
    place-items:center !important;
    width:44px !important; height:44px !important; border-radius:50% !important;
    background:rgba(255,255,255,.95) !important;
    box-shadow:0 8px 20px rgba(0,0,0,.18) !important;
    opacity:1 !important; visibility:visible !important;
    z-index:10051 !important;
    border:0 !important;
  }

  /* Ø£ÙŠ Ø²Ø± Ø±Ø¬ÙˆØ¹ â€œØ£Ø³ÙˆØ¯/Ø¹Ø§Ù…â€ ÙŠØ¸Ù‡Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¹Ø±Ø¶ Ù†Ø­Ø°ÙÙ‡ Ø¨ØµØ±ÙŠÙ‹Ø§ */
  .gallery > .air-fab:not(.keep),
  .gallery .btn-back,
  .gallery .back-button,
  .gallery .nav-back,
  .gallery .header-back{
    display:none !important;
  }

  /* Ù„Ø§ ØªØ³Ù…Ø­ Ù„Ø£ÙŠ ØºØ·Ø§Ø¡ Ø£Ù† ÙŠØ­Ø¬Ø¨ Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
  .gallery-main,
  .gallery-main *{
    z-index:auto;
  }
  .hero-fade{ z-index:1 !important; }
  .air-fab-left, .air-fab-right{ z-index:10050 !important; } /* Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ù‡ÙŠØ±Ùˆ */
}
</style>

<style>
  /* Ø§Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø§Ù„Ø£Ø³ÙˆØ¯ Ø§Ù„Ø¹Ø§Ø¦Ù… Ø¯Ø§Ø®Ù„ ØµÙØ­Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙÙ‚Ø· */
  body.item-page #flowBackBtn{ display:none !important; }

  /* Ù„Ùˆ Ø§Ù„Ø²Ø± ÙŠÙØ±Ø³Ù… ÙƒØ²Ø± Ø¹Ø§Ø¦Ù… Ø¹Ø§Ù… Ø¨Ø§Ø³Ù… air-fab Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¬Ø§Ù„ÙŠØ±ÙŠ */
  body.item-page .air-fab{ display:none !important; }

  /* Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ ØµÙ†Ù Ø¨Ø¯ÙŠÙ„ Ù„Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ */
  body.item-page .air-fab-left,
  body.item-page .air-fab-back{ display:none !important; }
</style>


<section class="items-shell">
  {% if not item %}
    <div class="card-glass"><div class="card-body"><div class="alert alert-danger">Item not found.</div></div></div>
  {% else %}

  <div class="grid-2">
    <!-- ===== Item / Gallery ===== -->
    <div class="card-glass">
      <div class="gallery">
        {# Gather images #}
        {% set _srcs = [] %}
        {% if item.image_path %}
          {% set _raw = item.image_path %}
          {% if ',' in _raw %}{% set _srcs = _raw.split(',') %}
          {% elif '|' in _raw %}{% set _srcs = _raw.split('|') %}
          {% else %}{% set _srcs = [_raw] %}{% endif %}
        {% endif %}
        {% set current = _srcs[0] if _srcs else None %}

        {% macro build_src(p) -%}
          {%- set s = (p or '') -%}
          {%- if not (s.startswith('http') or s.startswith('/')) -%}{%- set s = '/' + s -%}{%- endif -%}
          {{- s -}}
        {%- endmacro %}

        <div class="gallery-main" id="gMain">
          {% if current %}
            <img id="mainImg" src="{{ build_src(current) }}" alt="item image">
            <div class="hero-fade" id="heroFade"></div>
          {% else %}
            <div style="display:grid;place-items:center;height:100%;color:#8b94a7;font-size:13px">No image</div>
          {% endif %}

          <!-- â‹® Menu (ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ) -->
          <div class="gallery-menu dropdown d-none d-md-block">
            <button class="btn-menu" data-bs-toggle="dropdown" aria-expanded="false" title="Options">â‹®</button>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><button class="dropdown-item" data-bs-toggle="offcanvas" data-bs-target="#reportSheet" id="openReportBtn" type="button">ğŸš© Report listing</button></li>
            </ul>
          </div>

          <!-- ===== ADD: ÙŠØ³Ø§Ø± Ø§Ù„ØµÙˆØ±Ø© â€” Ø³Ù‡Ù… Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¯Ø§Ø®Ù„ Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ ===== -->
          <div class="air-fab-left d-md-none">
            <a class="air-fab" href="javascript:history.length>1?history.back():'/'" aria-label="Back">
              <i class="bi bi-arrow-left"></i>
            </a>
          </div>

          <!-- FABs + Counter (ÙŠÙ…ÙŠÙ† ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ) -->
          <div class="air-fab-right">
            <!-- Ù…Ø´Ø§Ø±ÙƒØ© -->
            <div id="afRight" class="air-fab-right">
  <button type="button" class="air-fab js-share keep" aria-label="Share"
          data-title="{{ item.title }}" data-url="{{ request.url }}"><i class="bi bi-share"></i></button>
  <button type="button" class="air-fab js-fav keep" aria-label="Save"
          data-item-id="{{ item.id }}" data-on="{{ 1 if is_favorite else 0 }}">
    <i class="bi {% if is_favorite %}bi-heart-fill{% else %}bi-heart{% endif %}"></i>
  </button>
          </div>

          <div class="air-pager" id="airPager">1/1</div>

          {% if _srcs|length > 1 %}
            <div class="thumbs" id="thumbs">
              {% for s in _srcs %}
                {% set src = build_src(s.strip()) %}
                <img data-src="{{ src }}" data-index="{{ loop.index0 }}" class="{% if loop.index0==0 %}active{% endif %}" src="{{ src }}" alt="thumb {{ loop.index }}">
              {% endfor %}
            </div>
          {% endif %}
        </div>
      </div>

      <!-- ===== White Rounded Sheet ===== -->
      <div class="card-body air-sheet">
        <h2 class="card-title">{{ item.title }}</h2>
        <div class="small-muted" style="margin-bottom:8px">
          {{ item.category_label or item.category }} â€¢ {{ item.city or "No city" }} â€¢ {{ owner and owner.country or "" }}
        </div>

        {# Rating row with black/gray stars #}
        {% set _avg = item_rating_avg or 0 %}
        {% set _cnt = item_rating_count or 0 %}
        <div class="laurel-row">
          <div class="score">
            <span class="stars-bw" aria-label="{{ '%.2f'|format(_avg) }} out of 5">
              {% set full = _avg|round(0, 'floor')|int %}
              {% set half = 1 if _avg - full >= 0.5 else 0 %}
              {% for i in range(0, full) %}<span class="full">â˜…</span>{% endfor %}
              {% if half %}<span class="full">â˜…</span>{% endif %}
              {% for i in range(0, 5 - full - half) %}<span class="empty">â˜†</span>{% endfor %}
            </span>
            <small>{{ '%.2f'|format(_avg) }} / 5</small>
          </div>
          <div class="laurel-mid">
            <img class="laurel" src="{{ url_for('static', path='photo/ion.png') }}" alt="laurel left">
            <span style="font-weight:800">Visitor Favorite</span>
            <img class="laurel" src="{{ url_for('static', path='photo/ion2.png') }}" alt="laurel right">
          </div>
          <div class="score">{{ _cnt }} <small>review(s)</small></div>
        </div>

        {% if item.description %}
          <p style="white-space:pre-wrap;line-height:1.9;color:#374151">{{ item.description }}</p>
        {% else %}
          <div class="badge-pill">No description</div>
        {% endif %}

        <div class="hr"></div>

        <!-- Reviews slider -->
        <h5 style="margin:0 0 8px 0">Reviews</h5>
        {% if item_reviews and item_reviews|length %}
          <div class="rv-strip">
            {% for r in item_reviews %}
              <div class="rv-card" id="review-{{ r.id }}">
                <div class="rv-head">
                  {% set avatar = (r.rater.avatar_path if r.rater and r.rater.avatar_path else url_for('static', path='placeholder.png')) %}
                  <img class="rv-ava" src="{{ avatar }}" alt="avatar">
                  <div>
                    <div style="font-weight:700">{{ (r.rater.first_name ~ ' ' ~ r.rater.last_name) if r.rater else 'Renter' }}</div>
                    <div class="rv-meta">{{ r.city or '' }} <span>â€¢</span> {{ r.created_at.strftime("%B %Y") if r.created_at }}</div>
                  </div>
                </div>
                <div class="rv-stars" title="{{ r.stars }} / 5">
                  {% for _ in range(r.stars) %}<span class="full">â˜…</span>{% endfor %}
                  {% for _ in range(5 - r.stars) %}<span class="empty">â˜†</span>{% endfor %}
                </div>
                {% if r.comment %}
                  <div style="margin-top:6px;white-space:pre-wrap">{{ r.comment }}</div>
                  <a href="/items/{{ item.id }}#review-{{ r.id }}" class="rv-more">View more</a>
                {% endif %}
              </div>
            {% endfor %}
          </div>
          <a href="/items/{{ item.id }}#all-reviews" class="btn-outline-pale">View all {{ _cnt }} review(s)</a>
        {% else %}
          <div class="small-muted">No reviews yet.</div>
        {% endif %}

        <div class="hr"></div>

        <!-- Buttons (desktop/extra) -->
        <div class="btns-row">
          {% if owner %}
            <a class="btnx btnx-primary" href="/messages/start?user_id={{ owner.id }}&item_id={{ item.id }}">ğŸ’¬ Contact owner</a>
            {% if session_user and session_user.status == 'approved' and session_user.id != owner.id %}
              <a class="btnx btnx-green" href="/bookings/new?item_id={{ item.id }}">âœ… Book now</a>
            {% elif not session_user %}
              <a class="btnx btnx-primary" href="/login">Log in to book</a>
            {% else %}
              <span class="badge-pill" title="Account activation required to book">Your account isnâ€™t activated for booking</span>
            {% endif %}
          {% endif %}
          <a class="btnx btnx-ghost" href="/items">â†©ï¸ Back to list</a>
        </div>

        <!-- ===== ADD: Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ù„Ø§Øº Ø¨Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø© (Ù…ÙˆØ¨Ø§ÙŠÙ„ ÙÙ‚Ø·) ===== -->
        

      <!-- ===== Bottom Booking Bar (Fixed) ===== -->
      <div class="air-fixed" id="airBar">
        <div class="air-price">
          <span class="now">{{ item.price_per_day }} {{ item.currency or 'KWD' }}</span>
          <span class="per">per day</span>
        </div>
        {% if owner and session_user and session_user.status == 'approved' and session_user.id != owner.id %}
          <a class="air-cta" href="/bookings/new?item_id={{ item.id }}">Book now</a>
        {% elif not session_user %}
          <a class="air-cta" href="/login">Sign in to pay</a>
        {% else %}
          <a class="air-cta" href="/messages/start?user_id={{ owner.id }}&item_id={{ item.id }}">Contact</a>
        {% endif %}
      </div>
    </div>
    <div class="air-underlay" id="airUnder"></div>

    <!-- ===== Owner Card ===== -->
    <div class="card-glass">
      <div class="card-body">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px">
          <h5 style="margin:0">Owner</h5>
          <span class="badge-pill">Stripe Connect â€¢ Receive earnings</span>
        </div>

        {% if owner %}
          <div class="owner-row">
            <img class="owner-avatar" src="{{ owner.avatar_path or url_for('static', path='placeholder.png') }}" alt="owner">
            <div>
              <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">
                <strong>{{ owner.first_name }} {{ owner.last_name }}</strong>
                {{ render_badges(owner_badges, 22) }}
              </div>
              <div class="small-muted">Member since {{ owner.created_at.strftime("%Y-%m-%d") if owner.created_at else "" }}</div>
            </div>
          </div>
          <div class="hr"></div>
          <div class="btns-row">
            <a href="/users/{{ owner.id }}" class="btnx btnx-ghost">ğŸ‘¤ Public profile</a>
            <a class="btnx btnx-primary" href="/messages/start?user_id={{ owner.id }}&item_id={{ item.id }}">Message owner</a>
          </div>
        {% else %}
          <div class="small-muted">Owner information not available.</div>
        {% endif %}
      </div>
    </div>

  </div>
  <div class="hr d-md-none"></div>
  <p class="air-report-bottom d-md-none">
    <a href="#reportSheet"
       class="air-report-link"
       data-bs-toggle="offcanvas"
       data-bs-target="#reportSheet"
       aria-controls="reportSheet">ğŸš© Report this listing</a>
  </p>


  {% endif %}
</section>

<!-- ===== Report Bottom Sheet ===== -->
<div class="offcanvas offcanvas-top"
     tabindex="-1"
     id="reportSheet"
     aria-labelledby="reportLabel"
     dir="rtl"
     data-bs-scroll="true"
     data-bs-backdrop="true">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="reportLabel">ğŸš© Report listing</h5>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body small">
    <form method="post" action="/reports" id="reportForm">
      <input type="hidden" name="item_id" value="{{ item.id }}">
      <input type="hidden" name="image_index" id="rf_image_index" value="0">
      <input type="hidden" name="image_url" id="rf_image_url" value="">
      <div class="mb-3">
        <label class="form-label">Reason</label>
        <select class="form-select" name="reason" required>
          <option value="" selected disabled>Select a report reason</option>
          <option value="nudity">Inappropriate content/Nudity</option>
          <option value="violence">Violence/Hate</option>
          <option value="scam">Scam/Fraud</option>
          <option value="copyright">Copyright</option>
          <option value="spam">Spam</option>
          <option value="other">Other</option>
        </select>
      </div>
      <div class="mb-3">
        <label class="form-label">Additional notes</label>
        <textarea class="form-control" name="note" rows="3" placeholder="Write details that help us reviewâ€¦"></textarea>
      </div>
      <button class="btn btn-danger w-100" type="submit">Submit report</button>
    </form>
  </div>
</div>

<script>
(function(){
  const main  = document.getElementById('mainImg');
  const thumbs= document.getElementById('thumbs');
  const pager = document.getElementById('airPager');
  const heroFade = document.getElementById('heroFade');
  const airBar = document.getElementById('airBar');

  /* ==== Lightbox ==== */
  let lb=null;
  function openLightbox(src){
    if(!lb){
      lb=document.createElement('div');
      lb.className='lightbox';
      lb.innerHTML='<button class="close">Close âœ•</button><img alt="preview">';
      document.body.appendChild(lb);
      lb.querySelector('.close').onclick=()=>lb.classList.remove('show');
      lb.onclick=(e)=>{ if(e.target===lb) lb.classList.remove('show'); };
    }
    lb.querySelector('img').src=src; lb.classList.add('show');
  }

  /* ==== Image counter ==== */
  function setPager(i,t){ if(pager){ pager.textContent=(i+1)+'/'+t; } }
  let activeIdx=0;
  function totalImgs(){ return thumbs ? thumbs.querySelectorAll('img').length : (main?1:0); }
  setPager(activeIdx,totalImgs());

  /* ==== Switch image ==== */
  if(thumbs && main){
    thumbs.addEventListener('click', (e)=>{
      const t=e.target;
      if(t.tagName==='IMG'){
        main.src=t.dataset.src||t.src;
        [...thumbs.querySelectorAll('img')].forEach(i=>i.classList.remove('active'));
        t.classList.add('active');
        activeIdx=parseInt(t.getAttribute('data-index')||'0',10)||0;
        setPager(activeIdx,totalImgs());
        document.getElementById('rf_image_index')?.setAttribute('value', String(activeIdx));
        document.getElementById('rf_image_url')?.setAttribute('value', t.dataset.src || t.src || '');
      }
    });
    let sx=0,dx=0;
    thumbs.addEventListener('touchstart',e=>{sx=e.touches[0].clientX},{passive:true});
    thumbs.addEventListener('touchmove',e=>{dx=e.touches[0].clientX-sx},{passive:true});
    thumbs.addEventListener('touchend',()=>{thumbs.scrollBy({left:-dx,behavior:'smooth'});sx=dx=0});
  }

  /* ==== Parallax + Fade (Airbnb-like) ==== */
  const gMain = document.getElementById('gMain');
  function onScroll(){
    if(!gMain || !main) return;
    const rect = gMain.getBoundingClientRect();
    const h = rect.height || 1;
    const visibleTop = Math.max(0, -rect.top);
    const p = Math.min(1, visibleTop / (h * .35));
    const scale = 1 + (visibleTop>0 ? Math.min(visibleTop/1000, .06) : 0);
    main.style.transform = `scale(${scale}) translateY(${visibleTop* -0.06}px)`;
    main.style.opacity = String(1 - p*0.85);
    if(heroFade) heroFade.style.opacity = String(p);
  }
  window.addEventListener('scroll', onScroll, {passive:true});
  onScroll();

  /* ==== FORCE the bar to be fixed & visible on iOS ==== */
  function portalBar(){
  if(!airBar) return;
  if(airBar.parentElement !== document.body){
    document.body.appendChild(airBar);
  }
  const under = document.getElementById('airUnder');
  if(under && under.parentElement !== document.body){
    document.body.appendChild(under);
  }
  const pad = (airBar.offsetHeight || 64) + 12; // Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø´Ø±ÙŠØ· + Ù…Ø³Ø§ÙØ©
  document.body.style.paddingBottom = pad + 'px';

  /* Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ù…Ø±Ù‘Ø± Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø¥Ù„Ù‰ CSS Ù„ÙŠØ³ØªØ¹Ù…Ù„Ù‡ Ø§Ù„Ù€ offcanvas */
  document.documentElement.style.setProperty('--airbar-h', pad + 'px');
}

  portalBar();
  window.addEventListener('resize', portalBar);
  window.addEventListener('orientationchange', portalBar);
  document.body.classList.add('item-page');

})();
</script>

<script>document.body.classList.add('item-page');</script>
<script>
(function(){
  // theme color Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© ÙÙ‚Ø·
  var m = document.querySelector('meta[name="theme-color"]');
  if(m){ m.setAttribute('content', '#ffffff'); }

  var ms = document.querySelector('meta[name="apple-mobile-web-app-status-bar-style"]');
  if(!ms){
    ms = document.createElement('meta');
    ms.setAttribute('name','apple-mobile-web-app-status-bar-style');
    document.head.appendChild(ms);
  }
  ms.setAttribute('content','default'); 
})();
</script>

<script>
(function(){
  // Share
  const shareBtn = document.querySelector('.js-share');
  if (shareBtn) {
    shareBtn.addEventListener('click', async () => {
      const url = shareBtn.dataset.url || location.href;
      const title = shareBtn.dataset.title || document.title;
      try {
        if (navigator.share) {
          await navigator.share({ title, url });
        } else if (navigator.clipboard && window.isSecureContext) {
          await navigator.clipboard.writeText(url);
          alert('Link copied âœ”');
        } else {
          const ta = document.createElement('textarea');
          ta.value = url; document.body.appendChild(ta); ta.select();
          document.execCommand('copy'); document.body.removeChild(ta);
          alert('Link copied âœ”');
        }
      } catch(e){ /* user cancelled */ }
    });
  }

  // Favorite toggle
  const favBtn = document.querySelector('.js-fav');
  if (favBtn) {
    const icon = favBtn.querySelector('i');
    function setOn(on){
      favBtn.dataset.on = on ? '1':'0';
      favBtn.classList.toggle('is-on', !!on);
      icon.classList.toggle('bi-heart-fill', !!on);
      icon.classList.toggle('bi-heart', !on);
      favBtn.classList.remove('fav-anim');
      void favBtn.offsetWidth;
      favBtn.classList.add('fav-anim');
    }

    favBtn.addEventListener('click', async () => {
      const itemId = favBtn.dataset.itemId;
      try {
        const res = await fetch('/api/favorites/toggle', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ item_id: itemId })
        });
        if (res.status === 401) { location.href = '/login?next=' + encodeURIComponent(location.pathname); return; }
        const data = await res.json();
        if (data && data.ok) setOn(!!data.favorited);
      } catch(e){
        setOn(favBtn.dataset.on !== '1');
      }
    });

    setOn(favBtn.dataset.on === '1');
  }
})();
</script>

<script>
(function(){
  const main  = document.getElementById('mainImg');
  // ... Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ù‚ÙŠØ© Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª

  /* Ø§Ø¶Ø¨Ø· Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„ØµÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© */
  if (main) {
    const initSrc = main.getAttribute('src') || '';
    document.getElementById('rf_image_index')?.setAttribute('value','0');
    document.getElementById('rf_image_url')?.setAttribute('value', initSrc);
  }

  /* Ø¨Ø§Ù‚ÙŠ Ø³ÙƒØ±Ø¨ØªØ§ØªÙƒ ÙƒÙ…Ø§ Ù‡ÙŠâ€¦ */
})();
</script>

<script>
(function(){
  const gMain   = document.getElementById('gMain');
  if(!gMain) return;

  /* 1) Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø²Ø± ØºØ±ÙŠØ¨ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¹Ø±Ø¶ (ØºÙŠØ± Ù…ÙØ¹Ù„Ù‘Ù… Ø¨Ù€ .keep) */
  [...gMain.querySelectorAll('.air-fab')]
    .filter(el => !el.classList.contains('keep') && !el.closest('.air-fab-left') && !el.closest('.air-fab-right'))
    .forEach(el => el.remove());

  /* 2) ØªØ£ÙƒÙŠØ¯ ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø­Ø§ÙˆÙŠØªÙŠÙ† ÙˆØ¥Ù†Ø´Ø§Ø¡Ù‡Ù…Ø§ Ø¥Ù† Ù„Ø²Ù… */
  let afLeft  = document.getElementById('afLeft');
  let afRight = document.getElementById('afRight');

  if(!afLeft){
    afLeft = document.createElement('div');
    afLeft.id = 'afLeft';
    afLeft.className = 'air-fab-left d-md-none';
    afLeft.innerHTML = (
      '<a class="air-fab keep" href="javascript:history.length>1?history.back():\'/\'" aria-label="Back">' +
      '<i class="bi bi-arrow-left"></i></a>'
    );
    gMain.appendChild(afLeft);
  }
  if(!afRight){
    afRight = document.createElement('div');
    afRight.id = 'afRight';
    afRight.className = 'air-fab-right';
    afRight.innerHTML = (
      '<button type="button" class="air-fab js-share keep" aria-label="Share"><i class="bi bi-share"></i></button>' +
      '<button type="button" class="air-fab js-fav keep" aria-label="Save"><i class="bi bi-heart"></i></button>'
    );
    gMain.appendChild(afRight);
  }

  /* 3) Ø±ÙØ¹ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª ÙÙˆÙ‚ Ø£ÙŠ ØºØ·Ø§Ø¡ */
  const setZ = () => {
    const zTop = 10050;
    afLeft.style.zIndex  = zTop;
    afRight.style.zIndex = zTop;
    const hf = document.getElementById('heroFade');
    if(hf) hf.style.zIndex = 1;
  };
  setZ();
  window.addEventListener('scroll', setZ, {passive:true});
  window.addEventListener('resize', setZ);

  /* 4) Ø³Ù„ÙˆÙƒ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© (Ù„Ùˆ Ø£Ù†Ø´Ø£Ù†Ø§ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§) */
  const shareBtn = afRight.querySelector('.js-share');
  if(shareBtn && !shareBtn._wired){
    shareBtn._wired = true;
    shareBtn.addEventListener('click', async () => {
      const url = shareBtn.dataset.url || location.href;
      const title = shareBtn.dataset.title || document.title;
      try {
        if (navigator.share) { await navigator.share({ title, url }); }
        else if (navigator.clipboard && window.isSecureContext) {
          await navigator.clipboard.writeText(url); alert('Link copied âœ”');
        } else {
          const ta=document.createElement('textarea'); ta.value=url; document.body.appendChild(ta);
          ta.select(); document.execCommand('copy'); ta.remove(); alert('Link copied âœ”');
        }
      } catch(e){}
    });
  }

  /* 5) Ù…Ù„Ø¡ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¨Ù„Ø§Øº Ø¨ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© */
  const mainImg = document.getElementById('mainImg');
  if (mainImg){
    document.getElementById('rf_image_index')?.setAttribute('value','0');
    document.getElementById('rf_image_url')?.setAttribute('value', mainImg.getAttribute('src') || '');
  }
})();
</script>

<script>document.body.classList.add('item-page');</script>



{% endblock %}
