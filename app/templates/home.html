<!-- home.html -->
{% extends "base.html" %}
{% from "_badges.html" import render_badges %}

{% block content %}

<!-- ======= Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ======= -->
<section class="home-hero text-center mb-4">
  <h1 class="mb-2">Ù…Ù†ØµØ© ØªØ£Ø¬ÙŠØ± Ø£ÙŠ Ø´ÙŠØ¡ â€” Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©</h1>
  <p class="lead mb-3">Ø§Ø¨Ø¯Ø£ Ø¨ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ ÙˆØ±ÙØ¹ ÙˆØ«ÙŠÙ‚Ø© Ø±Ø³Ù…ÙŠØ© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ù† Ø§Ù„Ø£Ø¯Ù…ÙŠÙ†.</p>

  {% if not session_user %}
    <a href="/register" class="btn btn-primary btn-lg">ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</a>
    <a href="/login" class="btn btn-ghost btn-lg ms-2">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
  {% else %}
    <a href="/profile" class="btn btn-primary btn-lg">Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ ØµÙØ­ØªÙŠ</a>
    {% if session_user.role == 'admin' %}
      <a href="/admin" class="btn btn-warning btn-lg ms-2">Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…ÙŠÙ†</a>
    {% endif %}
  {% endif %}
</section>

<!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù… -->
<form method="get" action="/" class="card card-search mb-3">
  <div class="card-body">
    <div class="row g-2 align-items-center">
      <div class="col-md-4">
        <input type="text" name="q" value="{{ search_q|default('') }}"
               class="form-control form-control-lg"
               placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ (camera, Ø®ÙŠÙ…Ø©, Ø³ÙŠØ§Ø±Ø©...)">
      </div>
      <div class="col-md-3">
        <input type="text" name="city" value="{{ search_city|default('') }}"
               class="form-control form-control-lg"
               placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© (Ù…Ø«Ø§Ù„: montreal)">
      </div>
      <div class="col-md-3">
        <select class="form-select form-select-lg" name="category">
          <option value="" {{ '' == (current_category|default('')) and 'selected' or '' }}>ÙƒÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option>
          {% for cat in categories %}
            <option value="{{ cat.key }}" {{ cat.key == (current_category|default('')) and 'selected' or '' }}>
              {{ cat.label }}
            </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2 d-flex gap-2">
        <select class="form-select form-select-lg" name="sort">
          <option value="" {{ not sort and 'selected' or '' }}>Ø§Ù„Ø£Ø­Ø¯Ø«</option>
          <option value="pop" {{ sort=='pop' and 'selected' or '' }}>Ø§Ù„Ø£ÙƒØ«Ø± Ø´Ù‡Ø±Ø©</option>
          <option value="price_asc" {{ sort=='price_asc' and 'selected' or '' }}>Ø§Ù„Ø³Ø¹Ø± â†‘</option>
          <option value="price_desc" {{ sort=='price_desc' and 'selected' or '' }}>Ø§Ù„Ø³Ø¹Ø± â†“</option>
        </select>
        <button class="btn btn-primary btn-lg w-100" type="submit">Ø§Ø¨Ø­Ø«</button>
      </div>
    </div>
  </div>
</form>

<!-- ÙÙ„Ø§ØªØ± Ø³Ø±ÙŠØ¹Ø© -->
<div class="d-flex flex-wrap align-items-center justify-content-between mb-3">
  <div class="mb-2 home-cats">
    <a class="btn btn-sm {{ not current_category and 'btn-primary' or 'btn-ghost' }}" href="/">Ø§Ù„ÙƒÙ„</a>
    {% for cat in categories %}
      <a class="btn btn-sm {{ current_category==cat.key and 'btn-primary' or 'btn-ghost' }}"
         href="/?category={{ cat.key }}">{{ cat.label }}</a>
    {% endfor %}
  </div>

  <div class="mb-2">
    <a class="btn btn-sm btn-ghost"
       href="{{ '/' if not current_category else '/?category=' ~ current_category }}">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ØµØ± ğŸ”„</a>
  </div>
</div>

<!-- Ø´Ø¨ÙƒØ© Ø§Ù„Ø¹Ù†Ø§ØµØ± -->
<div class="home-grid">
  {% for it in items %}
    {% set owner = it.owner if it.owner is defined else None %}
    <article class="card spot">
      <div class="spot-media">
        {% if it.image_path %}
          <img src="/{{ it.image_path }}" alt="item">
        {% else %}
          <img src="{{ url_for('static', path='img/placeholder.png') }}" alt="no image">
        {% endif %}
        <div class="spot-overlay"></div>

        {% if it.price_per_day is not none %}
        <div class="price-badge">
          <strong>{{ it.price_per_day }}</strong><span> Ø¯/ÙŠÙˆÙ…</span>
        </div>
        {% endif %}

        {% if it.category_label %}
        <div class="category-chip">{{ it.category_label }}</div>
        {% endif %}
      </div>

      <div class="card-body">
        <h5 class="spot-title" title="{{ it.title }}">{{ it.title }}</h5>

        <div class="spot-body">
          <div class="owner-line d-flex align-items-center gap-2 mb-2">
            {% if owner and owner.avatar_path %}
              <img src="/{{ owner.avatar_path }}" class="owner-avatar" alt="avatar">
            {% else %}
              <div class="owner-avatar owner-avatar--placeholder">ğŸ‘¤</div>
            {% endif %}
            <span class="small text-muted d-inline-flex align-items-center gap-1">
              {{ (owner and (owner.first_name ~ ' ' ~ owner.last_name)) or 'Ù…Ø³ØªØ®Ø¯Ù…' }}
              {% if owner %}{{ render_badges(owner, '16px') }}{% endif %}
            </span>
          </div>

          <div class="d-flex align-items-center justify-content-between spot-footer">
            <div class="small city-chip" title="{{ it.city or '' }}">ğŸ™ï¸ {{ it.city or 'Ø¨Ø¯ÙˆÙ† Ù…Ø¯ÙŠÙ†Ø©' }}</div>
            <a href="/items/{{ it.id }}" class="btn btn-sm btn-primary">ØªÙØ§ØµÙŠÙ„</a>
          </div>
        </div>
      </div>
    </article>
  {% else %}
    <div class="card p-4 text-center text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø§Ù„Ø¢Ù†.</div>
  {% endfor %}
</div>

{% endblock %}
