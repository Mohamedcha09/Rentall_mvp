{% extends "base.html" %}
{% from "_badges.html" import render_badges %}
{% block content %}

<!-- Ù‡ÙŠØ±Ùˆ Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© -->
<section class="home-hero text-center mb-4">
  <h1 class="mb-3">Ù…Ù†ØµØ© ØªØ£Ø¬ÙŠØ± Ø£ÙŠ Ø´ÙŠØ¡ â€” Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©</h1>
  <p class="lead">Ø§Ø¨Ø¯Ø£ Ø¨ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ ÙˆØ±ÙØ¹ ÙˆØ«ÙŠÙ‚Ø© Ø±Ø³Ù…ÙŠØ© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ù† Ø§Ù„Ø£Ø¯Ù…ÙŠÙ†.</p>
  {% if not session_user %}
    <a href="/register" class="btn btn-primary btn-lg">ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</a>
    <a href="/login" class="btn btn-outline-light btn-lg ms-2">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
  {% else %}
    <a href="/profile" class="btn btn-primary btn-lg">Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ ØµÙØ­ØªÙŠ</a>
    {% if session_user.role == 'admin' %}
      <a href="/admin" class="btn btn-warning btn-lg ms-2">Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…ÙŠÙ†</a>
    {% endif %}
  {% endif %}
</section>

<!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨Ø­Ø« -->
<form method="get" action="/" class="card card-search mb-3">
  <div class="card-body">
    <div class="row g-2 align-items-center">
      <div class="col-md-5">
        <input type="text" name="q" value="{{ search_q | default('') }}"
               class="form-control form-control-lg"
               placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ (Ù…Ø«Ø§Ù„: camera, Ø®ÙŠÙ…Ø©, Ø³ÙŠØ§Ø±Ø©...)">
      </div>
      <div class="col-md-4">
        <input type="text" name="city" value="{{ search_city | default('') }}"
               class="form-control form-control-lg"
               placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© (Ù…Ø«Ø§Ù„: montreal)">
      </div>
      <div class="col-md-3 d-flex gap-2">
        {% if current_category %}
          <input type="hidden" name="category" value="{{ current_category }}">
        {% endif %}
        <button class="btn btn-primary btn-lg w-100" type="submit">Ø§Ø¨Ø­Ø«</button>
      </div>
    </div>
  </div>
</form>

<!-- ÙÙ„Ø§ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª + Ø²Ø± ØªØ­Ø¯ÙŠØ« -->
<div class="d-flex flex-wrap align-items-center justify-content-between mb-3">
  <div class="mb-2 home-cats">
    <a class="btn btn-sm {% if not current_category %}btn-primary{% else %}btn-outline-light{% endif %}" href="/">Ø§Ù„ÙƒÙ„</a>
    {% for cat in categories %}
      <a class="btn btn-sm {% if current_category == cat.key %}btn-primary{% else %}btn-outline-light{% endif %}"
         href="/?category={{ cat.key }}">{{ cat.label }}</a>
    {% endfor %}
  </div>

  <div class="mb-2">
    <a class="btn btn-sm btn-outline-light"
       href="{{ '/' if not current_category else '/?category=' ~ current_category }}">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ØµØ± ğŸ”„</a>
  </div>
</div>

<!-- Ø´Ø¨ÙƒØ© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø­Ø¯ÙŠØ«Ø© -->
<div class="home-grid">
  {% for it in items %}
    <article class="card spot">
      <!-- ØµÙˆØ±Ø© Ù…ÙˆØ­Ù‘Ø¯Ø© -->
      <div class="spot-media">
        {% if it.image_path %}
          <img src="/{{ it.image_path }}" alt="item">
        {% else %}
          <div class="spot-placeholder d-flex align-items-center justify-content-center">Ù„Ø§ ØµÙˆØ±Ø©</div>
        {% endif %}
        <div class="spot-overlay"></div>

        <!-- Ø´Ø§Ø±Ø§Øª -->
        <div class="price-badge"><strong>{{ it.price_per_day }}</strong><span> Ø¯/ÙŠÙˆÙ…</span></div>
        <div class="category-chip">{{ it.category_label }}</div>
      </div>

      <!-- Ø¬Ø³Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© -->
      <div class="card-body spot-body">
        <!-- Ø¹Ù†ÙˆØ§Ù† -->
        <h5 class="card-title spot-title" title="{{ it.title }}">{{ it.title }}</h5>

        <!-- Ø§Ù„Ù…Ø§Ù„Ùƒ -->
        <div class="owner-line d-flex align-items-center gap-2">
          {% if it.owner and it.owner.avatar_path %}
            <img src="/{{ it.owner.avatar_path }}" class="owner-avatar" alt="avatar">
          {% else %}
            <div class="owner-avatar owner-avatar--placeholder">ğŸ‘¤</div>
          {% endif %}
          <span class="small text-muted d-inline-flex align-items-center gap-1 flex-wrap">
            {{ it.owner.first_name }} {{ it.owner.last_name }}
            {% if it.owner %}{{ render_badges(it.owner, '16px') }}{% endif %}
          </span>
        </div>

        <!-- Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© + Ø²Ø± -->
        <div class="spot-footer d-flex align-items-center justify-content-between">
          <div class="small city-chip" title="{{ it.city or '' }}">ğŸ™ï¸ {{ it.city or 'Ø¨Ø¯ÙˆÙ† Ù…Ø¯ÙŠÙ†Ø©' }}</div>
          <a href="/items/{{ it.id }}" class="btn btn-sm btn-primary">ØªÙØ§ØµÙŠÙ„</a>
        </div>
      </div>
    </article>
  {% else %}
    <p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø§Ù„Ø¢Ù†.</p>
  {% endfor %}
</div>

<!-- Ø³ØªØ§ÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠ -->
<style>
/* Ø´Ø¨ÙƒØ© Ù…ÙˆØ­Ù‘Ø¯Ø© */
.home-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(270px,1fr));
  gap:18px;
}

/* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
.card.spot{
  display:flex;
  flex-direction:column;
  height:100%;
  border-radius:18px;
  overflow:hidden;
}

/* Ø§Ù„ØµÙˆØ±Ø© */
.spot-media{
  position:relative;
  aspect-ratio:16/10;
  overflow:hidden;
  background:rgba(255,255,255,.03);
  border-bottom:1px solid var(--border);
}
.spot-media > img{
  width:100%; height:100%;
  object-fit:cover;
  display:block;
  transition:transform .25s ease;
}
.card.spot:hover .spot-media > img{ transform:scale(1.025); }

/* overlay ÙˆØ§Ù„Ø´Ø§Ø±Ø§Øª */
.spot-overlay{ position:absolute; inset:0;
  background:linear-gradient(180deg, transparent 55%, rgba(15,17,21,.55));
}
.price-badge,.category-chip{ position:absolute; top:12px; z-index:2; }
.price-badge{ inset-inline-start:12px; }
.category-chip{ inset-inline-end:12px; }

/* Ø¬Ø³Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
.spot-body{ flex:1; display:flex; flex-direction:column; gap:10px; }
.spot-title{
  margin:2px 0 4px;
  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
  overflow:hidden;
  min-height:2.8em;
}
.owner-line{ min-height:30px; }
.spot-footer{ margin-top:auto; }
.city-chip{
  max-width:65%;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.card.spot *{ max-width:100%; }
</style>

{% endblock %}
