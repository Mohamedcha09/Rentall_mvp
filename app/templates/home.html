{% extends "base.html" %}
{% block content %}

<!-- قسم شائع -->
<div class="section-head">
  <div class="section-title">شائع بالقرب منك</div>
  <div class="d-flex gap-2">
    <button class="arrow-btn" data-snap-prev="#row-pop"><i class="bi bi-chevron-right"></i></button>
    <button class="arrow-btn" data-snap-next="#row-pop"><i class="bi bi-chevron-left"></i></button>
  </div>
</div>
<div id="row-pop" class="hrow">
  {% for it in popular_items %}
  <a href="/items/{{ it.id }}" class="card spot hcard text-decoration-none">
    <div class="spot-media">
      <img src="{{ it.image_path or '/static/placeholder.jpg' }}" alt="">
      <div class="spot-overlay"></div>
      <span class="price-badge">{{ it.price_per_day|default(0) }}$ /يوم</span>
      <span class="category-chip">{{ category_label(it.category) }}</span>
    </div>
    <div class="card-body spot-body">
      <div class="spot-title">{{ it.title }}</div>
      <div class="owner-line">
        <div class="owner-avatar--placeholder">🏷️</div>
        <span class="city-chip">{{ it.city or '—' }}</span>
      </div>
      <div class="spot-footer">
        <small class="text-muted">تقييم {{ it.rating|default(4.8) }}</small>
        <i class="bi bi-arrow-left-short"></i>
      </div>
    </div>
  </a>
  {% endfor %}
</div>

<!-- سلايدر لكل تصنيف -->
{% for cat in categories %}
  {% set code = cat.code %}
  {% set list = items_by_category.get(code, []) %}
  {% if list %}
  <div class="section-head mt-3">
    <div class="section-title">{{ category_label(code) }}</div>
    <a class="text-muted small" href="/items?category={{ code }}">عرض الكل</a>
  </div>
  <div id="row-{{ code }}" class="hrow">
    {% for it in list %}
    <a href="/items/{{ it.id }}" class="card spot hcard text-decoration-none">
      <div class="spot-media">
        <img src="{{ it.image_path or '/static/placeholder.jpg' }}" alt="">
        <div class="spot-overlay"></div>
        <span class="price-badge">{{ it.price_per_day|default(0) }}$ /يوم</span>
        <span class="category-chip">{{ category_label(it.category) }}</span>
      </div>
      <div class="card-body spot-body">
        <div class="spot-title">{{ it.title }}</div>
        <div class="owner-line">
          <div class="owner-avatar--placeholder">🏷️</div>
          <span class="city-chip">{{ it.city or '—' }}</span>
        </div>
        <div class="spot-footer">
          <small class="text-muted">تقييم {{ it.rating|default(4.8) }}</small>
          <i class="bi bi-arrow-left-short"></i>
        </div>
      </div>
    </a>
    {% endfor %}
  </div>
  {% endif %}
{% endfor %}

<!-- شبكة مختلطة أسفل الصفحة -->
<div class="section-head mt-3">
  <div class="section-title">اكتشف المزيد</div>
</div>
<div class="mixed-grid">
  {% for it in mixed_items %}
  <a href="/items/{{ it.id }}" class="card spot text-decoration-none">
    <div class="spot-media">
      <img src="{{ it.image_path or '/static/placeholder.jpg' }}" alt="">
      <div class="spot-overlay"></div>
      <span class="category-chip">{{ category_label(it.category) }}</span>
    </div>
    <div class="card-body spot-body">
      <div class="spot-title">{{ it.title }}</div>
      <div class="owner-line">
        <div class="owner-avatar--placeholder">🏷️</div>
        <span class="city-chip">{{ it.city or '—' }}</span>
      </div>
    </div>
  </a>
  {% endfor %}
</div>

{% endblock %}
{% block scripts %}
<script>
  // أزرار التمرير للسلايدر
  function snap(el, dir=1){
    const node = document.querySelector(el);
    if(!node) return;
    const w = node.clientWidth * 0.9;
    node.scrollBy({left: dir*w, behavior:'smooth'});
  }
  document.querySelectorAll('[data-snap-prev]').forEach(b=>{
    b.addEventListener('click', ()=> snap(b.dataset.snapPrev, -1));
  });
  document.querySelectorAll('[data-snap-next]').forEach(b=>{
    b.addEventListener('click', ()=> snap(b.dataset.snapNext, +1));
  });
</script>
{% endblock %}
