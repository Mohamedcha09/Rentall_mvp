{% extends "base.html" %}
{% block content %}
  <h2 class="mb-2">بلاغ وديعة</h2>
  <p class="text-muted mb-4">
    الحجز رقم <strong>#{{ booking.id }}</strong> — العنصر:
    <a href="/items/{{ item.id }}" target="_blank">{{ item.title }}</a>
<div class="container mt-4">
  <h3 class="mb-3">فتح بلاغ وديعة — حجز #{{ bk.id }}</h3>

  <div class="card">
    <div class="card-body">

      <!-- مهم: enctype حتى تُرسل الملفات والحقول -->
      <form method="post"
            action="/deposits/{{ bk.id }}/report"
            enctype="multipart/form-data">

        <!-- اسم الحقل يجب أن يكون issue_type -->
        <div class="mb-3">
          <label class="form-label">نوع المشكلة</label>
          <select name="issue_type" class="form-select" required>
            <option value="delay">تأخير في الإرجاع</option>
            <option value="damage">أضرار/خدوش</option>
            <option value="loss">فقدان جزء/إكسسوار</option>
            <option value="theft">سرقة/فقدان كامل</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label">وصف مختصر لما حدث</label>
          <textarea name="description" class="form-control" rows="4"
                    placeholder="الرجاء ذكر التفاصيل والتواريخ والقيمة التقريبية للأضرار إن وُجدت"></textarea>
        </div>

        <!-- اسم الحقل يجب أن يكون files -->
        <div class="mb-3">
          <label class="form-label">إرفاق أدلة (صور/فيديو) — يمكن اختيار عدة ملفات</label>
          <input type="file" name="files" class="form-control" multiple>
          <div class="form-text">الامتدادات المسموحة: png, jpg, jpeg, webp, gif, mp4, mov, m4v, avi, wmv</div>
        </div>

        <div class="d-flex gap-2">
          <a href="/bookings/flow/{{ bk.id }}" class="btn btn-secondary">إلغاء</a>
          <button type="submit" class="btn btn-danger">إرسال البلاغ</button>
        </div>

      </form>

    </div>
  </div>
</div>
{% endblock %}