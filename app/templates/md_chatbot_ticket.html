{% extends "base.html" %}
{% block content %}

<div class="page">
  <a href="/md/chatbot/inbox" class="btn btn-light mt-3">â† Back</a>

  <h2 class="mt-4">ğŸ‘‘ MD Ticket #{{ ticket.id }}</h2>

  {% set is_closed = (ticket.status == 'closed') %}

  <hr>

  <div class="chat-thread mt-3">
    {% for m in msgs %}
      <div class="mb-3 p-3 border rounded {% if m.sender_role == 'agent' %}bg-light{% else %}bg-white{% endif %}">
        <div>
          <strong>{{ m.sender_role|capitalize }}</strong>
          <span class="text-muted small">â€” {{ m.created_at }}</span>
        </div>
        <div class="mt-2">{{ m.body }}</div>
      </div>
    {% endfor %}
  </div>

  <hr>

  {% if not is_closed %}
  <!-- Reply -->
  <form action="/md/chatbot/ticket/{{ ticket.id }}/reply" method="post" class="mt-3">
    <textarea name="body" class="form-control" rows="3" placeholder="Replyâ€¦"></textarea>
    <button class="btn btn-primary mt-2">Send Reply</button>
  </form>
  {% endif %}

  <hr>

  {% if not is_closed %}
  <!-- â­ TRANSFER TO CS -->
  <form action="/chatbot/ticket/{{ ticket.id }}/transfer" method="post" class="mt-2">
    <input type="hidden" name="new_queue" value="cs_chatbot">
    <button class="btn btn-warning w-100">Transfer to CS</button>
  </form>

  <!-- â­ TRANSFER TO MOD -->
  <form action="/chatbot/ticket/{{ ticket.id }}/transfer" method="post" class="mt-2">
    <input type="hidden" name="new_queue" value="mod_chatbot">
    <button class="btn btn-danger w-100">Transfer to MOD</button>
  </form>
  {% endif %}

  <hr>

  {% if not is_closed %}
  <!-- Close -->
  <form action="/chatbot/ticket/{{ ticket.id }}/close" method="post" class="mt-3"
        onsubmit="return confirm('Close permanently?');">
      <button class="btn btn-dark w-100">Close Ticket</button>
  </form>
  {% else %}
  <div class="alert alert-secondary">ğŸ”’ Closed</div>
  {% endif %}
</div>

{% endblock %}
