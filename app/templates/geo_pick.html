{% extends "base.html" %}
{% block content %}

<div class="container py-5" style="max-width:640px;">
  <div class="card shadow-sm border-0" style="border-radius:18px;">
    <div class="card-body p-4 p-md-5">
      <h1 class="h3 mb-3 text-center">Ø§Ø®ØªØ± Ø¯ÙˆÙ„ØªÙƒ</h1>
      <p class="text-muted text-center mb-4">
        Ù†Ø³ØªØ®Ø¯Ù… Ø¯ÙˆÙ„ØªÙƒ Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„ÙƒØŒ ØªÙ…Ø§Ù…Ø§Ù‹ Ù…Ø«Ù„ Airbnb.
      </p>

      <div id="geoError" class="alert alert-danger d-none small"></div>

      <div class="d-grid gap-3">
        <button type="button" class="btn btn-outline-secondary btn-lg" onclick="chooseCountry('CA')">
          ğŸ‡¨ğŸ‡¦  Ø£Ù†Ø§ ÙÙŠ ÙƒÙ†Ø¯Ø§ (CAD)
        </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" onclick="chooseCountry('US')">
          ğŸ‡ºğŸ‡¸  Ø£Ù†Ø§ ÙÙŠ Ø£Ù…Ø±ÙŠÙƒØ§ (USD)
        </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" onclick="chooseCountry('FR')">
          ğŸ‡ªğŸ‡º  Ø£Ù†Ø§ ÙÙŠ Ø£ÙˆØ±ÙˆØ¨Ø§ (EUR)
        </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" onclick="chooseCountry('US')">
          ğŸŒ  Ø¨Ø§Ù‚ÙŠ Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø§Ù„Ù… (USD)
        </button>
      </div>

      <p class="text-muted small mt-4 mb-0 text-center">
        Ù„Ù† Ù†ØºÙŠÙ‘Ø± Ø¯ÙˆÙ„ØªÙƒ Ø£Ùˆ Ø¹Ù…Ù„ØªÙƒ Ø¨Ø¹Ø¯ Ù‡Ø°Ø§ Ø¥Ù„Ø§ Ø¥Ø°Ø§ Ø·Ù„Ø¨Øª Ø°Ù„Ùƒ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.
      </p>
    </div>
  </div>
</div>

<script>
async function chooseCountry(code){
  const errBox = document.getElementById('geoError');
  errBox.classList.add('d-none');
  errBox.textContent = '';

  try{
    const res = await fetch(`/geo/set?loc=${encodeURIComponent(code)}`, {
      method: 'GET',
      headers: { 'Accept': 'application/json' }
    });

    const data = await res.json();

    if(!data.ok){
      if(data.error === 'country_mismatch'){
        errBox.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¯ÙˆÙ„ØªÙƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©.';
      } else {
        errBox.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
      }
      errBox.classList.remove('d-none');
      return;
    }

    // Ù†Ø¬Ø§Ø­ â†’ Ø§Ø¯Ø®Ù„Ù‡ Ù„Ù„Ù…ÙˆÙ‚Ø¹ (Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù…Ø«Ù„Ø§Ù‹)
    window.location.href = '/';
  }catch(e){
    errBox.textContent = 'Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ø­Ø§ÙˆÙ„ Ù…Ù† Ø¬Ø¯ÙŠØ¯.';
    errBox.classList.remove('d-none');
  }
}
</script>

{% endblock %}
