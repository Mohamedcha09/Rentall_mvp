{% extends "base.html" %}
{% block content %}

<div class="page">
  <a href="/mod/chatbot/inbox" class="btn btn-light mt-3">â† Back</a>

  <h2 class="mt-4">ğŸ›¡ï¸ MOD â€” Chatbot Ticket #{{ ticket.id }}</h2>

  <p class="text-muted">Subject: {{ ticket.subject }}</p>

  <hr>

  {% for m in msgs %}
    <div class="mb-3 p-3 border rounded {% if m.sender_role == 'agent' %}bg-light{% else %}bg-white{% endif %}">
      <strong>{{ 'Agent' if m.sender_role == 'agent' else 'User' }}</strong>
      <span class="text-muted small">â€” {{ m.created_at }}</span>
      <div class="mt-2">{{ m.body | safe }}</div>
    </div>
  {% endfor %}

  <hr>

  <form action="/mod/chatbot/ticket/{{ ticket.id }}/reply" method="post" class="mt-3">
    <textarea name="body" class="form-control" rows="3" placeholder="Write replyâ€¦"></textarea>
    <button class="btn btn-primary mt-2">Send Reply</button>
  </form>

  <hr>

  <!-- â­ TRANSFER FORM (NEW) -->
  <form action="/chatbot/ticket/{{ ticket.id }}/transfer" method="post" class="mt-3">
    <label class="fw-bold">Transfer ticket to:</label>
    <select name="new_queue" class="form-control">
      <option value="md_chatbot">MD</option>
    </select>
    <button class="btn btn-warning mt-2">Transfer</button>
  </form>

  <hr>

  <form action="/mod/chatbot/tickets/{{ ticket.id }}/resolve" method="post" class="mt-3">
    <button class="btn btn-success">Resolve</button>
  </form>

</div>

{% endblock %}
