{% extends "base.html" %}
{% block content %}
<div class="container py-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§Øº #{{ r.id }}</h3>
    <div class="d-flex gap-2">
      <a href="/admin/reports" class="btn btn-outline-secondary">â¬…ï¸ Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</a>
      {% if item_id %}
        <a href="/items/{{ item_id }}" class="btn btn-outline-primary" target="_blank">ğŸ”— Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</a>
      {% endif %}
    </div>
  </div>

  <div class="row g-3">
    <div class="col-lg-7">
      <div class="card">
        <div class="card-header fw-bold">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
        <div class="card-body">
          <div class="row gy-2">
            <div class="col-6"><b>Ø§Ù„Ø­Ø§Ù„Ø©:</b> {{ r.status or 'â€”' }}</div>
            <div class="col-6"><b>Ø§Ù„ÙˆØ³Ù…:</b> {{ r.tag or 'â€”' }}</div>
            <div class="col-6"><b>Ø§Ù„Ù…Ù†Ø´ÙˆØ±:</b> {{ item_id or 'â€”' }}</div>
            <div class="col-6"><b>Ø§Ù„ØµÙˆØ±Ø©:</b> {{ r.image_index if r.image_index is not none else 'â€”' }}</div>
            <div class="col-12"><b>Ø§Ù„Ø³Ø¨Ø¨:</b> {{ r.reason or 'â€”' }}</div>
            <div class="col-12"><b>Ù…Ù„Ø§Ø­Ø¸Ø©:</b> {{ r.note or 'â€”' }}</div>
            <div class="col-6"><b>Ø£ÙÙ†Ø´Ø¦:</b> {{ r.created_at or 'â€”' }}</div>
            <div class="col-6"><b>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</b> {{ r.updated_at or 'â€”' }}</div>
            <div class="col-6"><b>Ø§Ù„Ù…Ø¨Ù„Ù‘ÙØº:</b> {{ r.reporter_id or 'â€”' }}</div>
            <div class="col-6"><b>Ù…Ø§Ù„Ùƒ Ø§Ù„Ù…Ù†Ø´ÙˆØ±:</b> {{ owner_id or 'â€”' }}</div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-5">
      {% if is_pending %}
      <!-- Ù‚Ø±Ø§Ø±Ø§Øª Ù„Ù„Ø¨Ù„Ø§Øº Ø§Ù„Ù…Ø¹Ù„Ù‘Ù‚ -->
      <div class="card">
        <div class="card-header bg-warning-subtle fw-bold">Ø§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø±</div>
        <div class="card-body">
          <form method="post" action="/admin/reports/{{ r.id }}/decision" class="row g-2">
            <input type="hidden" name="note" id="noteInput">
            <div class="col-12">
              <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ù‚Ø±Ø§Ø±</label>
              <textarea id="noteArea" class="form-control" rows="2" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>
            </div>
            <div class="col-12 d-flex flex-wrap gap-2">
              <button name="action" value="suspend_item" class="btn btn-warning">â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±</button>
              <button name="action" value="delete_item"  class="btn btn-danger">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±</button>
              <button name="action" value="reject_report" class="btn btn-secondary">âŒ Ø±ÙØ¶ Ø§Ù„Ø¨Ù„Ø§Øº</button>
              <button name="action" value="close_only" class="btn btn-outline-dark">ğŸ“ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¨Ù„Ø§Øº ÙÙ‚Ø·</button>
            </div>
          </form>
        </div>
      </div>
      {% else %}
      <!-- Ø£Ø²Ø±Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© -->
      <div class="card">
        <div class="card-header bg-success-subtle fw-bold">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</div>
        <div class="card-body">
          <form method="post" action="/admin/reports/{{ r.id }}/decision" class="d-flex flex-wrap gap-2 mb-2">
            <button name="action" value="restore_item" class="btn btn-success">â™»ï¸ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</button>
          </form>
          <form method="post" action="/admin/reports/{{ r.id }}/reopen" class="d-flex flex-wrap gap-2">
            <button class="btn btn-outline-primary">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­ Ø§Ù„Ø¨Ù„Ø§Øº</button>
          </form>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // ÙÙ‚Ø· Ù„Ù†Ø³Ø® Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ù…Ø®Ø²Ù†Ø© ÙÙŠ Ø§Ù„Ù€ textarea Ø¥Ù„Ù‰ Ø­Ù‚Ù„ "note" Ø¹Ù†Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø£ÙŠ Ø²Ø±
  (function(){
    const form = document.querySelector('form[action*="/decision"]');
    if (!form) return;
    form.addEventListener('submit', function(e){
      const noteArea = document.getElementById('noteArea');
      const noteInput = document.getElementById('noteInput');
      if (noteArea && noteInput) noteInput.value = noteArea.value || '';
    });
  })();
</script>
{% endblock %}