{% extends "base.html" %}
{% block content %}
<div class="container py-3">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§Øº #{{ r.id }}</h3>
    <a class="btn btn-outline-secondary btn-sm" href="/admin/reports">â† Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</a>
  </div>

  <div class="card mb-3">
    <div class="card-body">
      <div class="mb-2"><b>Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù:</b>
        {{ 'ØµÙˆØ±Ø© #' ~ r.image_index if r.image_index is not none else 'Ø§Ù„Ù…Ù†Ø´ÙˆØ±' }}
        #{{ r.item_id }}
      </div>
      <div><b>Ø§Ù„Ø³Ø¨Ø¨:</b> {{ r.reason }}</div>
      {% if r.note %}<div class="text-muted"><b>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø³Ø§Ø¨Ù‚Ø©:</b> {{ r.note }}</div>{% endif %}
      <div class="small text-muted mt-2">
        Ø§Ù„Ø­Ø§Ù„Ø©: {{ r.status }}{% if r.tag %} â€” {{ r.tag }}{% endif %}
      </div>
      <div class="mt-2">
        <a class="btn btn-link p-0" target="_blank" href="/items/{{ r.item_id }}">ğŸ”— Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</a>
      </div>
    </div>
  </div>

  {% if reporter %}
    <div class="card mb-3">
      <div class="card-header">ØµØ§Ø­Ø¨ Ø§Ù„Ø¨Ù„Ø§Øº</div>
      <div class="card-body">
        <div>{{ reporter.first_name }} {{ reporter.last_name }}</div>
        <div class="small text-muted">{{ reporter.email }}</div>
      </div>
    </div>
  {% endif %}

  {% if item %}
    <div class="card mb-3">
      <div class="card-header">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†Ø´ÙˆØ±</div>
      <div class="card-body">
        <div><b>ID:</b> {{ item.id }}</div>
        {% if item.title %}<div><b>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</b> {{ item.title }}</div>{% endif %}
        <div class="small text-muted">
          Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù†ØµØ±:
          {% if item.status is defined %}
            {{ item.status }}
          {% else %}
            {{ 'active' if item.is_active == 'yes' else 'inactive' }}
          {% endif %}
        </div>
      </div>
    </div>
  {% endif %}

  {% set is_pending = (r.status is not defined) or (r.status in ['pending','open']) %}

  {% if is_pending %}
    <form method="post" action="/admin/reports/{{ r.id }}/decision" class="card">
      <div class="card-header">Ù‚Ø±Ø§Ø±</div>
      <div class="card-body">
        <div class="mb-3">
          <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ù‚Ø±Ø§Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <textarea name="note" class="form-control" rows="2"></textarea>
        </div>
        <div class="d-flex flex-wrap gap-2">
          <button name="action" value="suspend_item" class="btn btn-warning">â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±</button>
          <button name="action" value="delete_item"  class="btn btn-danger">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±</button>
          <button name="action" value="reject_report" class="btn btn-secondary">âŒ Ø±ÙØ¶ Ø§Ù„Ø¨Ù„Ø§Øº</button>
          <a class="btn btn-outline-primary" target="_blank" href="/items/{{ r.item_id }}">ğŸ”— Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</a>
        </div>
      </div>
    </form>
  {% else %}
    <form method="post" action="/admin/reports/{{ r.id }}/reopen" class="d-inline">
      <button class="btn btn-outline-warning">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­ Ø§Ù„Ø¨Ù„Ø§Øº</button>
    </form>
    {% if item %}
      <form method="post" action="/admin/reports/{{ r.id }}/decision" class="d-inline ms-2">
        <input type="hidden" name="note" value="Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©">
        <button name="action" value="restore_item" class="btn btn-success">â™»ï¸ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</button>
      </form>
    {% endif %}
  {% endif %}

</div>
{% endblock %}
