{% extends "base.html" %}
{% block content %}
<div class="container py-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">Report Details #{{ r.id }}</h3>
    <div class="d-flex gap-2">
      <a href="/admin/reports" class="btn btn-outline-secondary">â¬…ï¸ Back to Reports</a>
      {% if item_id %}
        <a href="/items/{{ item_id }}" class="btn btn-outline-primary" target="_blank">ğŸ”— View Item</a>
      {% endif %}
    </div>
  </div>

  <div class="row g-3">
    <div class="col-lg-7">
      <div class="card">
        <div class="card-header fw-bold">Data</div>
        <div class="card-body">
          <div class="row gy-2">
            <div class="col-6"><b>Status:</b> {{ r.status or 'â€”' }}</div>
            <div class="col-6"><b>Tag:</b> {{ r.tag or 'â€”' }}</div>
            <div class="col-6"><b>Item:</b> {{ item_id or 'â€”' }}</div>
            <div class="col-6"><b>Image:</b> {{ r.image_index if r.image_index is not none else 'â€”' }}</div>
            <div class="col-12"><b>Reason:</b> {{ r.reason or 'â€”' }}</div>
            <div class="col-12"><b>Note:</b> {{ r.note or 'â€”' }}</div>
            <div class="col-6"><b>Created:</b> {{ r.created_at or 'â€”' }}</div>
            <div class="col-6"><b>Last Updated:</b> {{ r.updated_at or 'â€”' }}</div>
            <div class="col-6"><b>Reporter:</b> {{ r.reporter_id or 'â€”' }}</div>
            <div class="col-6"><b>Item Owner:</b> {{ owner_id or 'â€”' }}</div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-5">
      {% if is_pending %}
      <!-- Decisions for Pending Report -->
      <div class="card">
        <div class="card-header bg-warning-subtle fw-bold">Make a Decision</div>
        <div class="card-body">
          <form method="post" action="/admin/reports/{{ r.id }}/decision" class="row g-2">
            <input type="hidden" name="note" id="noteInput">
            <div class="col-12">
              <label class="form-label">Decision Note</label>
              <textarea id="noteArea" class="form-control" rows="2" placeholder="Your notes (optional)"></textarea>
            </div>
            <div class="col-12 d-flex flex-wrap gap-2">
              <button name="action" value="suspend_item" class="btn btn-warning">â¸ï¸ Suspend Item</button>
              <button name="action" value="delete_item"  class="btn btn-danger">ğŸ—‘ï¸ Delete Item</button>
              <button name="action" value="reject_report" class="btn btn-secondary">âŒ Reject Report</button>
              <button name="action" value="close_only" class="btn btn-outline-dark">ğŸ“ Close Report Only</button>
            </div>
          </form>
        </div>
      </div>
      {% else %}
      <!-- Buttons after Processing -->
      <div class="card">
        <div class="card-header bg-success-subtle fw-bold">Additional Actions</div>
        <div class="card-body">
          <form method="post" action="/admin/reports/{{ r.id }}/decision" class="d-flex flex-wrap gap-2 mb-2">
            <button name="action" value="restore_item" class="btn btn-success">â™»ï¸ Restore Item</button>
          </form>
          <form method="post" action="/admin/reports/{{ r.id }}/reopen" class="d-flex flex-wrap gap-2">
            <button class="btn btn-outline-primary">ğŸ”„ Reopen Report</button>
          </form>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // Only to copy the note stored in the textarea to the "note" field when any button is submitted
  (function(){
    const form = document.querySelector('form[action*="/decision"]');
    if (!form) return;
    form.addEventListener('submit', function(e){
      const noteArea = document.getElementById('noteArea');
      const noteInput = document.getElementById('noteInput');
      if (noteArea && noteInput) noteInput.value = noteArea.value || '';
    });
  })();
</script>
{% endblock %}
