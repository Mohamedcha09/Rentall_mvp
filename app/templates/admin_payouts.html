{% extends "base.html" %}
{% block content %}

<div class="container" style="max-width:1100px">

<!-- ================= RENT PAYOUTS ================= -->
<h3 class="mb-3 text-success">ðŸ’¸ Rent payouts</h3>

{% set rent_rows = rows | selectattr("type", "equalto", "rent") | list %}
{% if not rent_rows %}
  <div class="alert alert-success">No pending rent payouts.</div>
{% endif %}

{% for row in rent_rows %}
<div class="card mb-3 border-success">
  <div class="card-body">

    <div class="d-flex justify-content-between">
      <div>
        <h5 class="mb-1">
          Booking #{{ row.booking.id }}
          <span class="badge bg-success ms-2">RENT</span>
        </h5>
        <div class="text-muted">
          Owner: <strong>{{ row.owner.full_name }}</strong><br>
          Item ID: {{ row.booking.item_id }}
        </div>
      </div>

      <form method="post" action="/admin/payouts/{{ row.booking.id }}/mark-sent">
        <button class="btn btn-success">
          âœ” Mark rent as paid
        </button>
      </form>
    </div>

    <hr>

    <p>
      <strong>Amount:</strong>
      {{ row.amount }} {{ row.currency }}
    </p>

    {% if row.payout %}
      <small>
        Method: {{ row.payout.method|upper }}<br>
        Destination: {{ row.payout.destination }}
      </small>
    {% else %}
      <p class="text-danger">Owner has no payout method</p>
    {% endif %}

  </div>
</div>
{% endfor %}


<!-- ================= DEPOSIT PAYOUTS ================= -->
<h3 class="mt-5 mb-3 text-purple">ðŸ›¡ Deposit compensations</h3>

{% set deposit_rows = rows | selectattr("type", "equalto", "deposit") | list %}
{% if not deposit_rows %}
  <div class="alert alert-secondary">No deposit compensations.</div>
{% endif %}

{% for row in deposit_rows %}
<div class="card mb-3 border-purple bg-deposit">
  <div class="card-body">

    <div class="d-flex justify-content-between">
      <div>
        <h5 class="mb-1">
          Booking #{{ row.booking.id }}
          <span class="badge bg-purple ms-2">DEPOSIT</span>
        </h5>
        <div class="text-muted">
          Owner: <strong>{{ row.owner.full_name }}</strong><br>
          Reason: {{ row.reason or "Damage compensation" }}
        </div>
      </div>

      <form method="post" action="/admin/payouts/{{ row.booking.id }}/deposit/mark-sent">
        <button class="btn btn-purple">
          ðŸ›¡ Send deposit compensation
        </button>
      </form>
    </div>

    <hr>

    <p>
      <strong>Compensation amount:</strong>
      {{ row.amount }} {{ row.currency }}
    </p>

    {% if row.payout %}
      <small>
        Method: {{ row.payout.method|upper }}<br>
        Destination: {{ row.payout.destination }}
      </small>
    {% else %}
      <p class="text-danger">Owner has no payout method</p>
    {% endif %}

  </div>
</div>
{% endfor %}

</div>

<style>
/* ===== Deposit style ===== */
.text-purple { color: #7c3aed; }
.bg-purple { background-color: #7c3aed; }
.btn-purple {
  background-color: #7c3aed;
  color: white;
}
.btn-purple:hover {
  background-color: #6d28d9;
}
.border-purple {
  border-left: 6px solid #7c3aed;
}
.bg-deposit {
  background: #faf5ff;
}
</style>

{% endblock %}
