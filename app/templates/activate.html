{% extends "base.html" %}
{% block content %}

<div style="direction:ltr; text-align:left;">

  <div class="mb-4">
    <h3 class="mb-1">Complete Activation</h3>
    <div class="text-muted">Your current account status:
      <span class="badge
        {% if user.status == 'approved' %}bg-success
        {% elif user.status == 'pending' %}bg-warning text-dark
        {% else %}bg-danger{% endif %}">
        {{ user.status }}
      </span>
      {% if user.is_verified %}
        <img src="/static/verified.png" class="verified-badge" alt="Verified">
      {% endif %}
    </div>
  </div>

  {% if review_note %}
    <div class="alert alert-warning text-dark mb-4">
      <strong>Note from Admin:</strong>
      <div class="mt-1">{{ review_note }}</div>
    </div>
  {% endif %}

  <div class="row g-4">
    <!-- Update Account Photo -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-body">
          <h5 class="mb-3">Account Photo (captured by camera)</h5>
          {% if user.avatar_path %}
            <img src="{{ build_src(session_user.avatar_path or user.avatar_path) }}"
                 alt="avatar" style="width:120px;height:120px;object-fit:cover;border-radius:12px;border:1px solid var(--border)">
          {% else %}
            <div class="text-muted small mb-2">No photo uploaded yet.</div>
          {% endif %}

          <form method="post" action="/activate/avatar" enctype="multipart/form-data" class="mt-3">
            <input class="form-control" type="file" name="avatar" accept="image/*" capture="user" required>
            <div class="small text-muted mt-2">* Capture directly from the camera only.</div>
            <button class="btn btn-primary mt-3">Save Photo</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Re-upload Documents -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-body">
          <h5 class="mb-3">Re-upload Documents</h5>

          {% if docs and docs|length %}
            <div class="mb-3">
              <div class="small text-muted mb-1">Latest uploaded documents:</div>
              {% for d in docs|sort(attribute="created_at", reverse=True)[:1] %}
                <div class="d-flex align-items-center gap-3">
                  {% if d.file_front_path %}
                    <img src="/{{ d.file_front_path }}" style="width:96px;height:64px;object-fit:cover;border-radius:8px;border:1px solid var(--border)">
                  {% endif %}
                  {% if d.file_back_path %}
                    <img src="/{{ d.file_back_path }}" style="width:96px;height:64px;object-fit:cover;border-radius:8px;border:1px solid var(--border)">
                  {% endif %}
                  <span class="badge
                    {% if d.review_status == 'approved' %}bg-success
                    {% elif d.review_status == 'pending' %}bg-warning text-dark
                    {% else %}bg-danger{% endif %}">
                    {{ d.review_status }}
                  </span>
                </div>
              {% endfor %}
            </div>
          {% endif %}

          <form method="post" action="/activate/document" enctype="multipart/form-data">
            <div class="row g-2">
              <div class="col-6">
                <label class="form-label">Document Type</label>
                <select class="form-select" name="doc_type">
                  <option value="id_card">ID Card</option>
                  <option value="driver_license">Driver’s License</option>
                  <option value="passport">Passport</option>
                </select>
              </div>
              <div class="col-6">
                <label class="form-label">Country</label>
                <input class="form-control" name="country" placeholder="e.g., Algeria">
              </div>
              <div class="col-6">
                <label class="form-label">Expiry Date (optional)</label>
                <input class="form-control" name="expiry" placeholder="YYYY-MM-DD">
              </div>
            </div>

            <div class="mt-3">
              <label class="form-label">Front Side Image (required)</label>
              <input class="form-control" type="file" name="doc_front" accept="image/*,.pdf" required>
            </div>
            <div class="mt-2">
              <label class="form-label">Back Side Image (optional)</label>
              <input class="form-control" type="file" name="doc_back" accept="image/*,.pdf">
            </div>

            <button class="btn btn-success mt-3">Submit for Review</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Contact Admin button -->
  <div class="mt-4">
    <a class="btn btn-outline-light" href="/messages/start?user_id=1">Message Admin</a>
    <span class="small text-muted ms-2">Use this button to ask why you were rejected or what’s needed to activate your account.</span>
  </div>

</div>

{% endblock %}
