{# templates/dm_queue.html #}
{% extends "base.html" %}

{% block title %}قضايا الوديعة{% endblock %}

{% block content %}
<div class="card p-3 p-md-4">
  <div class="d-flex justify-content-between align-items-center flex-wrap">
    <h4 class="mb-2">قضايا الوديعة</h4>
    <a class="btn btn-light" href="/admin">العودة للوحة</a>
  </div>
  <hr>

  {% set list = cases or [] %}
  {% if not list %}
    <div class="alert alert-secondary">لا توجد قضايا حالياً. عند وصول بلاغات ستظهر هنا.</div>
  {% else %}
    <div class="table-responsive">
      <table class="table table-sm align-middle">
        <thead>
          <tr>
            <th>#</th>
            <th>العنصر</th>
            <th>المالك</th>
            <th>المستأجر</th>
            <th>حالة الحجز</th>
            <th>حالة الوديعة</th>
            <th>آخر تحديث</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
        {% for c in list %}
          {% set it = items_map.get(c.item_id) if items_map else None %}
          <tr>
            <td class="mono">{{ c.id }}</td>
            <td>
              {% if it %}
                <a href="/items/{{ it.id }}" target="_blank">{{ it.title }}</a>
              {% else %}
                —
              {% endif %}
            </td>
            <td>{{ (c.owner and c.owner.full_name) or c.owner_id }}</td>
            <td>{{ (c.renter and c.renter.full_name) or c.renter_id }}</td>
            <td><span class="badge bg-light text-dark">{{ c.status or '—' }}</span></td>
            <td><span class="badge bg-light text-dark">{{ c.deposit_status or '—' }}</span></td>
            <td class="mono small">{{ c.updated_at or c.created_at }}</td>
            <td>
              <a class="btn btn-outline-primary btn-sm" href="/dm/deposits/{{ c.id }}">
                فتح القضية
              </a>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  {% endif %}
</div>
{% endblock %}