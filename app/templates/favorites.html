{# app/templates/favorites.html #}
{% extends "base.html" %}

{% block head %}
<style>
  .favorites-grid{
    display:grid; gap:14px;
    grid-template-columns: repeat(auto-fill, minmax(220px,1fr));
  }
  @media (max-width:480px){
    .favorites-grid{ grid-template-columns: repeat(2, minmax(0,1fr)); }
  }

  /* Ø­Ø§Ù„Ø© Ø§Ù„ÙØ±Ø§Øº: ØµÙˆØ±Ø© ÙÙ‚Ø· */
  .empty-box{ padding:24px 8px; text-align:center; }
  .empty-box img{
    display:block; margin:10px auto; max-width:320px; width:76%;
    height:auto; object-fit:contain; opacity:.98;
  }
</style>
{% endblock %}

{% block content %}
<h4 class="mb-3">â¤ï¸ Ù…ÙØ¶Ù„ØªÙŠ</h4>

{% if items and items|length > 0 %}
  <div class="favorites-grid">
    {% for it in items %}
      <a href="/items/{{ it.id }}" class="card spot text-decoration-none">
        <div class="spot-media">
          <img src="{{ it.image_path or '/static/placeholder.jpg' }}" alt="">
          <div class="spot-overlay"></div>

          {% if it.price_per_day is defined %}
            <span class="price-badge">{{ it.price_per_day|default(0) }}$ /ÙŠÙˆÙ…</span>
          {% endif %}
          {% if it.category is defined %}
            <span class="category-chip">{{ category_label(it.category) }}</span>
          {% endif %}

          <!-- Ø²Ø± Ø§Ù„Ù…ÙØ¶Ù„Ø© (Ù…Ø¹Ù„Ù‘Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙƒÙ€ is-fav Ù‡Ù†Ø§) -->
          <button class="fav-btn is-fav" type="button" data-id="{{ it.id }}" aria-pressed="true">
            <i class="bi bi-heart-fill"></i>
          </button>
        </div>

        <div class="card-body spot-body">
          <div class="spot-title">{{ it.title }}</div>
          <div class="owner-line">
            <div class="owner-avatar--placeholder">ğŸ·ï¸</div>
            <span class="city-chip">{{ it.city or 'â€”' }}</span>
          </div>
        </div>
      </a>
    {% endfor %}
  </div>
{% else %}
  {# ØµÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§Ø±ØºØ©: son.png #}
  <div class="empty-box">
    <img src="{{ url_for('static', path='photo/son.png') }}" alt="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø§Ù„Ù…ÙØ¶Ù„Ø©">
  </div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
  // ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…ÙØ¶Ù„Ø© Ø¹Ø¨Ø± API Ø§Ù„ØµØ­ÙŠØ­ /api/favorites/{id}
  document.addEventListener('click', async (e)=>{
    const btn = e.target.closest('.fav-btn');
    if(!btn) return;

    e.preventDefault();
    e.stopPropagation();

    const id = Number(btn.dataset.id);
    const isFav = btn.classList.contains('is-fav');
    const method = isFav ? 'DELETE' : 'POST';

    try{
      const res = await fetch(`/api/favorites/${id}`, { method });
      if(!res.ok) throw new Error('bad response');

      // Ø­Ø¯Ù‘Ø« Ø§Ù„Ø²Ø± Ù…Ø­Ù„ÙŠÙ‹Ø§
      btn.classList.toggle('is-fav', !isFav);
      const icon = btn.querySelector('.bi');
      if(icon){
        icon.classList.toggle('bi-heart-fill', !isFav);
        icon.classList.toggle('bi-heart', isFav);
      }
      btn.setAttribute('aria-pressed', String(!isFav));
    }catch(err){
      console.error(err);
      alert('ØªØ¹Ø°Ù‘Ø± Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ± ÙÙŠ Ø§Ù„Ù…ÙØ¶Ù„Ø© Ù…Ø¤Ù‚ØªÙ‹Ø§.');
    }
  });
</script>
{% endblock %}
