{% extends "base.html" %}
{% block content %}

<style>
/* ================================
   BASIC CLEAN ELEGANT STYLE
================================ */
body {
    background: #f8f9fc !important;
}

.items-wrap {
    max-width: 1150px;
    margin: 0 auto;
    padding: 25px 15px 70px;
}

/* Title */
.page-title {
    font-size: 26px;
    font-weight: 700;
    color: #1a1a1c;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* Add Item Button */
.add-btn {
    background: #4f46e5;
    color: white;
    border-radius: 8px;
    padding: 7px 16px;
    font-weight: 600;
    text-decoration: none;
}
.add-btn:hover {
    background: #4338ca;
}

/* Simple card style */
.item-card {
    background: #ffffff;
    border-radius: 14px;
    box-shadow: 0 3px 14px rgba(0,0,0,0.08);
    overflow: hidden;
    transition: 0.25s;
    border: 1px solid #eee;
}
.item-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.12);
}

/* Item Image */
.item-card img {
    width: 100%;
    height: 170px;
    object-fit: cover;
    border-bottom: 1px solid #ddd;
}

/* Card content */
.card-body {
    padding: 14px 16px;
}

/* Title */
.item-title {
    font-size: 17px;
    font-weight: 600;
    color: #222;
}

/* Buttons */
.btn-open {
    background: #f3f4f6;
    padding: 5px 10px;
    border-radius: 6px;
    font-size: 13px;
    color: #333;
    font-weight: 600;
    border: none;
}
.btn-open:hover {
    background: #e5e7eb;
}

/* Price badge */
.price-badge {
    background: #eef2ff;
    color: #4f46e5;
    padding: 4px 10px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 13px;
}

/* Active / inactive */
.state-badge {
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 600;
}
.active-badge { background:#10b981; color:white; }
.inactive-badge { background:#6b7280; color:white; }

/* Status badge */
.status-badge {
    margin-top: 8px;
    background: #fde047;
    color: #111;
    padding: 4px 8px;
    border-radius: 6px;
    font-weight: 600;
    font-size: 12px;
}

/* Feedback box */
.feedback-box {
    margin-top: 8px;
    background: #fff7ed;
    border: 1px solid #fed7aa;
    color: #7c2d12;
    padding: 10px;
    border-radius: 8px;
    font-size: 14px;
}

/* Resubmit button */
.resubmit-btn {
    margin-top: 10px;
    background: #4f46e5;
    border-radius: 8px;
    padding: 7px 14px;
    color: white;
    font-weight: 600;
    border: none;
    width: 100%;
}
.resubmit-btn:hover {
    background: #4338ca;
}

/* Badges images (admin/new/gold/etc) */
.badge-icon {
    height:20px;
    width:20px;
    margin-inline-start:6px;
    vertical-align:middle;
}
</style>


<div class="items-wrap">

    <!-- HEADER -->
    <div class="page-title mb-4">
        <span>My Items â€” {{ session_user["first_name"] }} {{ session_user["last_name"] }}</span>
        <a class="add-btn" href="/owner/items/new">+ Add Item</a>
    </div>

    <!-- BADGES HOLDER -->
    <span id="badges-owner-self"
          data-role="{{ session_user.role if session_user else 'user' }}"
          data-created="{{ session_user.created_at.isoformat() if session_user and session_user.created_at else '' }}"
          data-verified="{{ 1 if (session_user and session_user.is_verified) else 0 }}"
          data-stars-all="0"
          data-avg="0"
          data-stars5="0"
          data-returns="0">
    </span>


    {% if items and items|length %}
    <div class="row g-4 mt-2">

        {% for it in items %}
        <div class="col-12 col-md-4">

            <div class="item-card">

                <!-- IMAGE (fixed!) -->
                {% if it.image_path %}
                    <img src="{{ it.image_path }}" alt="">
                {% else %}
                    <img src="/static/placeholder.jpg" alt="">
                {% endif %}

                <div class="card-body">

                    <div class="item-title">{{ it.title }}</div>

                    <div class="d-flex justify-content-between align-items-center mt-2">
                        <a href="/items/{{ it.id }}" class="btn-open">Open</a>
                        <span class="small text-muted">{{ it.category }}</span>
                    </div>

                    <div class="mt-3 d-flex align-items-center gap-2">
                        <span class="state-badge {% if it.is_active=='yes' %}active-badge{% else %}inactive-badge{% endif %}">
                            {% if it.is_active=='yes' %}Active{% else %}Inactive{% endif %}
                        </span>

                        <span class="price-badge">
                            {{ it.display_price }} {{ it.display_currency }}/day
                        </span>
                    </div>

                    {% if it.status != 'approved' %}
                    <div class="status-badge">{{ it.status }}</div>
                    {% endif %}

                    {% if it.admin_feedback %}
                    <div class="feedback-box">
                        <strong>Admin Feedback:</strong><br>{{ it.admin_feedback }}
                    </div>
                    {% endif %}

                    {% if it.status in ['rejected','needs_revision'] %}
                    <form action="/owner/items/{{ it.id }}/resubmit" method="post">
                        <button class="resubmit-btn">Resubmit for Review</button>
                    </form>
                    {% endif %}

                </div>
            </div>

        </div>
        {% endfor %}
    </div>

    {% else %}
    <div class="alert alert-light text-dark mt-3">
        No items yet. Add your first item.
    </div>
    {% endif %}

</div>

<!-- BADGES SCRIPT SAME AS BEFORE -->
<script>
(function(){
  function daysFrom(iso){ if(!iso) return 99999; const d=new Date(iso); if(isNaN(d)) return 99999; return Math.floor((Date.now()-d.getTime())/86400000); }
  function add(src,alt){ const i=document.createElement('img'); i.src=src; i.alt=alt; i.className='badge-icon'; return i; }
  function render(box){
    if(!box) return;
    const role=(box.dataset.role||'').toLowerCase();
    const days=daysFrom(box.dataset.created||'');
    const verified=Number(box.dataset.verified||0)===1;
    const fiveStar=Number(box.dataset.stars5||0);
    const returnsOk=Number(box.dataset.returns||0);

    if(role==='admin'){ box.appendChild(add('/static/img/adm.png','Admin')); }

    const allowYellow=(role!=='admin'), allowGreen=(role!=='admin'), allowViolet=(role!=='admin');

    if(allowYellow && days<60){ box.appendChild(add('/static/img/jaune.png','New')); }
    else if(allowGreen && days>=60 && days<365){ box.appendChild(add('/static/img/ProVert.png','Pro Green')); }
    else if(days>=365){ box.appendChild(add('/static/img/ProGold.png','Pro Gold')); }

    if(allowViolet && (verified || fiveStar>=20)){ box.appendChild(add('/static/img/violet.png','Trust')); }
    if(returnsOk>=10){ box.appendChild(add('/static/img/Vert.png','Safe Renter')); }
    if(fiveStar>=10){ box.appendChild(add('/static/img/orange.png','Top Rated')); }
  }
  render(document.getElementById('badges-owner-self'));
})();
</script>

{% endblock %}
