{% extends "base.html" %}
{% block content %}

<style>

/* ===========================
   ğŸ”¥ Ø®Ù„ÙÙŠØ© Sevor â€” Gradient
=========================== */
body {
    background: linear-gradient(135deg,#8b5cf6 0%, #5b9df9 100%) !important;
    background-attachment: fixed;
}

/* ===========================
   Ø§Ù„Ø­Ø§ÙˆÙŠØ©
=========================== */
.items-container {
    max-width: 1150px;
    margin: 0 auto;
    padding: 20px 15px 60px;
}

/* ===========================
   Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
=========================== */
.page-title {
    font-size: 26px;
    font-weight: 700;
    color: white;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

/* Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± */
.add-item-btn {
    background: #ffffff;
    color: #5b5bf9;
    font-weight: 600;
    border-radius: 10px;
    padding: 6px 16px;
    box-shadow: 0 4px 10px rgba(0,0,0,.18);
    border: none;
}
.add-item-btn:hover {
    background: #f0f0ff;
}

/* ===========================
   Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ù†ØµØ± â€” Glass UI
=========================== */
.item-card {
    background: rgba(255,255,255,0.22);
    backdrop-filter: blur(16px);
    border-radius: 18px;
    overflow: hidden;
    box-shadow: 0 6px 30px rgba(0,0,0,.22);
    transition: .25s;
    border: 1px solid rgba(255,255,255,.25);
}
.item-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 40px rgba(0,0,0,.28);
}

/* ØµÙˆØ±Ø© Ø§Ù„Ø¹Ù†ØµØ± */
.item-card img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    border-bottom: 1px solid rgba(255,255,255,0.3);
}

/* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
.card-body-custom {
    padding: 15px 16px;
    color: white;
}

/* Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù†ØµØ± */
.item-title {
    font-size: 18px;
    font-weight: 600;
}

/* Open button */
.btn-open {
    padding: 5px 12px;
    font-size: 13px;
    border-radius: 8px;
    background: rgba(255,255,255,0.3);
    color: #fff;
    font-weight: 600;
    border: 1px solid rgba(255,255,255,.4);
}
.btn-open:hover {
    background: rgba(255,255,255,0.5);
    color: #000;
}

/* Price badge */
.price-badge {
    background: #ffffff;
    color: #5b5bf9;
    padding: 5px 10px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 13px;
}

/* Active / Inactive badge */
.state-badge {
    padding: 4px 8px;
    border-radius: 6px;
    font-weight: 600;
    font-size: 12px;
}
.state-active { background:#10b981; }
.state-inactive { background:#6b7280; }

/* Status badge */
.status-badge {
    margin-top: 6px;
    background: #facc15;
    color: #000;
    padding: 4px 8px;
    border-radius: 6px;
    font-weight: 600;
    font-size: 12px;
}

/* Feedback */
.feedback-box {
    background: rgba(255,255,255,0.2);
    backdrop-filter: blur(10px);
    border-radius: 10px;
    padding: 10px;
    color: #fff;
    border: 1px solid rgba(255,255,255,.3);
    margin-top: 6px;
    font-size: 14px;
}

/* Resubmit button */
.resubmit-btn {
    margin-top: 8px;
    background: white;
    font-weight: 700;
    border-radius: 10px;
    color: #5b5bf9;
    padding: 6px 14px;
    border: none;
    box-shadow: 0 4px 12px rgba(0,0,0,.15);
}
.resubmit-btn:hover {
    background: #f0f0ff;
}

/* Badges Images */
.badge-icon {
    height:20px;
    width:20px;
    margin-inline-start:6px;
    vertical-align:middle;
}

</style>


<div class="items-container">

  <div class="page-title mb-4">
    <span>My Items </span>
    <a class="add-item-btn" href="/owner/items/new">+ Add Item</a>
  </div>

  {% set me = session_user %}
  {% set _created = me.created_at if me and me.created_at else None %}
  {% set _created_iso = _created.isoformat() if _created else "" %}
  {% set _role = me.role if me else 'user' %}
  {% set _verified = 1 if (me and me.is_verified) else 0 %}
  {% set _five_star_count = 0 %}
  {% set _returns_success_count = 0 %}
  {% set _ratings_count = 0 %}
  {% set _avg_stars = 0 %}

  <span id="badges-owner-self"
        data-role="{{ _role }}"
        data-created="{{ _created_iso }}"
        data-verified="{{ _verified }}"
        data-stars-all="{{ _ratings_count }}"
        data-avg="{{ _avg_stars }}"
        data-stars5="{{ _five_star_count }}"
        data-returns="{{ _returns_success_count }}">
  </span>

  {% if items and items|length %}
    <div class="row g-4 mt-2">

      {% for it in items %}
      <div class="col-12 col-md-4">
        <div class="item-card">

          {% if it.image_path %}
            <img src="/{{ it.image_path }}" alt="">
          {% endif %}

          <div class="card-body-custom">

            <div class="item-title">{{ it.title }}</div>

            <div class="d-flex justify-content-between align-items-center mt-2">
              <a href="/items/{{ it.id }}" class="btn-open">Open</a>
              <span class="small text-light">{{ it.category }}</span>
            </div>

            <div class="mt-3 d-flex align-items-center gap-2">
              <span class="state-badge {% if it.is_active=='yes' %}state-active{% else %}state-inactive{% endif %}">
                {% if it.is_active=='yes' %}Active{% else %}Inactive{% endif %}
              </span>

              <span class="price-badge">
                {{ it.display_price }} {{ it.display_currency }}/day
              </span>
            </div>

            {% if it.status != 'approved' %}
              <div class="status-badge">{{ it.status }}</div>
            {% endif %}

            {% if it.admin_feedback %}
              <div class="feedback-box">
                <strong>Admin Feedback:</strong><br>{{ it.admin_feedback }}
              </div>
            {% endif %}

            {% if it.status in ['rejected', 'needs_revision'] %}
              <form action="/owner/items/{{ it.id }}/resubmit" method="post">
                <button class="resubmit-btn">Resubmit for Review</button>
              </form>
            {% endif %}

          </div>
        </div>
      </div>
      {% endfor %}

    </div>

  {% else %}
    <div class="alert alert-light text-dark mt-3">
      No items yet. Start by adding your first item.
    </div>
  {% endif %}

</div>


<script>
(function(){
  function daysFrom(iso){ if(!iso) return 99999; const d=new Date(iso); if(isNaN(d)) return 99999; return Math.floor((Date.now()-d.getTime())/86400000); }
  function add(src,alt){ const i=document.createElement('img'); i.src=src; i.alt=alt; i.className='badge-icon'; return i; }
  function render(box){
    if(!box) return;
    const role=(box.dataset.role||'').toLowerCase();
    const days=daysFrom(box.dataset.created||'');
    const verified=Number(box.dataset.verified||0)===1;
    const fiveStar=Number(box.dataset.stars5||0);
    const returnsOk=Number(box.dataset.returns||0);

    if(role==='admin'){ box.appendChild(add('/static/img/adm.png','Admin')); }

    const allowYellow=(role!=='admin'), allowGreen=(role!=='admin'), allowViolet=(role!=='admin');

    if(allowYellow && days<60){ box.appendChild(add('/static/img/jaune.png','New')); }
    else if(allowGreen && days>=60 && days<365){ box.appendChild(add('/static/img/ProVert.png','Pro Green')); }
    else if(days>=365){ box.appendChild(add('/static/img/ProGold.png','Pro Gold')); }

    if(allowViolet && (verified || fiveStar>=20)){ box.appendChild(add('/static/img/violet.png','Trust')); }
    if(returnsOk>=10){ box.appendChild(add('/static/img/Vert.png','Safe Renter')); }
    if(fiveStar>=10){ box.appendChild(add('/static/img/orange.png','Top Rated')); }
  }
  render(document.getElementById('badges-owner-self'));
})();
</script>

{% endblock %}
