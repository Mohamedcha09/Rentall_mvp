/* =========================================================
   R E N T A L L  —  Ultra Glass UI (Light-only)
   يعمل مستقلاً عن base.html
   ========================================================= */

/* ------------ ألوان ومتغيرات عامة (أبيض فقط) ------------ */
:root{
  --bg:#f5f7fb;
  --glass:#ffffffd6;
  --surface:#ffffff;
  --panel:#ffffff;
  --card:#ffffff;

  --text:#0d1320;
  --muted:#667086;

  --primary:#7c5cff;
  --primary-2:#5a3eff;
  --success:#22c55e;
  --warning:#f8b84e;
  --danger:#ff4d6d;

  --border:rgba(0,0,0,.10);
  --ring: rgba(124,92,255,.25);
  --shadow: 0 18px 46px rgba(0,0,0,.08);

  --sidebar-w: 268px;
  --radius:16px;

  --brand:#5900ff;

  /* safe-area props (قد تُضبط من JS في base، لكن لدينا fallbacks) */
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-top:    env(safe-area-inset-top, 0px);
}

/* ------------ الأساسيات ------------ */
html,body{min-height:100%}
html, body { height: 100%; }
body{
  background:
    radial-gradient(1100px 800px at 80% -10%, rgba(124,92,255,.12), transparent 45%),
    radial-gradient(900px 600px at -10% 110%, rgba(0,229,168,.06), transparent 40%),
    var(--bg);
  color:var(--text);
  font-family:'Tajawal','Cairo',system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif;
  -webkit-font-smoothing:antialiased;  -moz-osx-font-smoothing:grayscale;
}
a{ color:inherit; text-decoration:none }
a:hover{ text-decoration:none; filter:brightness(1.05) }
.text-muted{ color:var(--muted)!important }
small, .small{ color:var(--muted)!important }

/* ------------ أزرار عامة ------------ */
.btn{ border-radius:12px; transition:transform .12s ease, filter .12s ease }
.btn:active{ transform:scale(.98) }
.btn-ghost{ background:transparent; color:inherit; border:1px solid var(--border); }
.btn-ghost:hover{ background:color-mix(in oklab, var(--text) 8%, transparent) }
.btn-primary{
  background:linear-gradient(135deg,var(--primary),var(--primary-2));
  border:0; box-shadow:0 12px 28px rgba(124,92,255,.18);
}
.btn-primary:hover{ filter:brightness(1.05) }
.btn-sm{ padding:.35rem .7rem; border-radius:12px }

/* ------------ أسطح (بطاقات/حقول/قوائم) ------------ */
.card, .alert, .list-group-item, .dropdown-menu,
.form-control, .form-select{
  background:linear-gradient(180deg, color-mix(in oklab, var(--card) 98%, transparent),
                                    color-mix(in oklab, var(--card) 96%, transparent));
  border:1px solid var(--border); color:var(--text); border-radius:var(--radius);
}
.card{ box-shadow:var(--shadow); transition:border-color .16s ease, box-shadow .16s ease, transform .16s ease }
.card:hover{ border-color:color-mix(in oklab, var(--primary) 28%, var(--border)); box-shadow:0 20px 44px rgba(124,92,255,.12); transform: translateY(-2px) }

.form-control, .form-select{ height:auto }
.form-control:focus, .form-select:focus{
  box-shadow:0 0 0 4px var(--ring); border-color:color-mix(in oklab, var(--primary) 55%, var(--border));
}

.dropdown-menu{ box-shadow:0 18px 40px rgba(0,0,0,.10) }
.dropdown-item{ color:inherit }
.dropdown-item:hover{ background:color-mix(in oklab, var(--text) 6%, transparent) }

.alert{ border-radius:14px }
.alert-warning{ color:inherit }

/* ------------ أفاتار ووسام التوثيق ------------ */
.avatar{
  width:26px; height:26px; border-radius:50%;
  display:grid; place-items:center; font-weight:800;
  background:color-mix(in oklab, var(--panel) 98%, white);
  color:color-mix(in oklab, var(--text) 92%, black);
  box-shadow:inset 0 0 0 1px var(--border);
}
.avatar.ring{ position:relative }
.avatar.ring::after{
  content:""; position:absolute; inset:-2px; border-radius:50%;
  background: conic-gradient(from 120deg, var(--primary), var(--primary-2), var(--primary));
  -webkit-mask: radial-gradient(farthest-side, transparent calc(100% - 2px), #000 0);
          mask: radial-gradient(farthest-side, transparent calc(100% - 2px), #000 0);
  filter:saturate(130%) blur(.2px);
}
.verify{ color:#1aa7ff; filter: drop-shadow(0 0 6px rgba(85,213,255,.35)) }

/* ------------ المساحة الرئيسية ------------ */
.page{
  padding: calc(64px + 18px) 20px 28px;
  margin-inline: 0;
  max-width: 1280px;
  transition: margin-inline-start .22s ease;
}
@media (max-width: 991.98px){ .page{ margin-inline:0; padding: calc(56px + 10px) 12px 110px } }
@media (min-width: 992px){ .page{ max-width: none; } }
.page{ padding-inline: 12px 20px; }
@media (max-width: 991.98px){ .page{ margin-inline: 0; } }

/* ======== ملء الشاشة — بدون حذف ======== */
#page-wrapper{
  min-height: 100dvh;
  min-height: 100svh;
  display: flex;
  flex-direction: column;
}
.main-flex-fill{ flex: 1 1 auto; }

/* ------------ شبكة العناصر ------------ */
.home-grid{
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  gap:16px;
}
.card.spot{
  display:flex; flex-direction:column; height:100%;
  border-radius:18px; overflow:hidden;
}
.spot-media{
  position:relative;
  aspect-ratio: 16 / 10;
  overflow:hidden;
  background: rgba(0,0,0,.02);
  border-bottom:1px solid var(--border);
}
.spot-media > img{
  width:100%; height:100%; object-fit:cover; display:block;
  transition: transform .22s ease;
}
.card.spot:hover .spot-media > img{ transform:scale(1.02) }
.spot-overlay{ position:absolute; inset:0; background: linear-gradient(180deg, transparent 55%, rgba(0,0,0,.10)); pointer-events:none; }
.price-badge, .category-chip{ position:absolute; top:10px; z-index:2; border-radius:999px; }
.price-badge{
  inset-inline-start:10px; padding:.3rem .55rem; font-weight:700; font-size:.9rem;
  background: rgba(0,0,0,.55); backdrop-filter: blur(8px);
  border:1px solid var(--border); color:#fff; box-shadow:0 6px 18px rgba(0,0,0,.12);
}
.category-chip{
  inset-inline-end:10px; padding:.2rem .5rem; font-size:.78rem; color:#5a3eff;
  background: rgba(124,92,255,.10); border:1px solid rgba(124,92,255,.25);
}
.card.spot .card-body{ padding:.7rem .75rem .8rem }
.spot-body{ display:flex; flex-direction:column; gap:10px; }
.spot-title{
  margin:2px 0 4px;
  display:-webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 2;
  overflow:hidden;
  min-height:2.8em;
  line-height:1.25;
}
.owner-line{ display:flex; align-items:center; gap:.5rem; min-height:28px }
.owner-avatar, .owner-avatar--placeholder{
  width:24px; height:24px; border-radius:50%;
  object-fit:cover; border:1px solid var(--border);
  display:grid; place-items:center; background:rgba(0,0,0,.03);
}
.city-chip{
  padding:.2rem .5rem; border-radius:999px;
  background: rgba(0,0,0,.03); border:1px solid var(--border);
  color:var(--muted);
  max-width:65%; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.spot-footer{ margin-top:auto; display:flex; align-items:center; justify-content:space-between }
@media (max-width: 480px){
  .home-grid{ grid-template-columns: repeat(auto-fill, minmax(180px,1fr)); gap:12px }
  .spot-title{ font-size:.95rem }
}

/* ===== سلايدر أفقي للبطاقات ===== */
.hrow{
  display:grid;
  grid-auto-flow: column;
  grid-auto-columns: 78%;
  gap:12px;
  overflow-x:auto;
  scroll-snap-type: x mandatory;
  -webkit-overflow-scrolling: touch;
  padding-inline: 4px;
}
@media (min-width:576px){ .hrow{ grid-auto-columns: 58%; } }
@media (min-width:992px){ .hrow{ grid-auto-columns: 360px; } }
.hcard{ scroll-snap-align: start; }
.hcard .spot-media{ aspect-ratio: 16/11; }

.section-head{ display:flex; align-items:center; justify-content:space-between; margin: 8px 4px 10px; }
.section-title{ font-weight:800; font-size:1.05rem }
.arrow-btn{ border:1px solid var(--border); background:transparent; border-radius:10px; width:36px; height:36px; display:grid; place-items:center; }
.arrow-btn:disabled{ opacity:.4 }

.mixed-grid{ display:grid; gap:12px; grid-template-columns: repeat(auto-fill, minmax(180px,1fr)); }
@media (min-width:576px){ .mixed-grid{ grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); } }

/****************************************************
 *  عناصر علوية للموبايل (Tabs)
 ****************************************************/
.m-top-tabs{
  position: sticky; top: 56px; z-index: 2000;
  display: grid; grid-auto-flow: column; gap: 8px; padding: 8px 12px;
  background: linear-gradient(180deg, rgba(0,0,0,.00), rgba(0,0,0,.04));
  backdrop-filter: blur(12px) saturate(120%);
  border-bottom: 1px solid var(--border);
}
.m-top-tabs .m-tab{
  display: inline-flex; align-items: center; justify-content: center;
  height: 36px; padding: 0 12px; font-weight: 700; font-size: .92rem; border-radius: 999px;
  color: var(--muted); text-decoration: none; border: 1px solid transparent;
  background: color-mix(in oklab, var(--panel) 98%, transparent);
  transition: background .15s ease, color .15s ease, transform .12s ease, border-color .15s ease;
}
.m-top-tabs .m-tab:hover{ transform: translateY(-1px); }
.m-top-tabs .m-tab.is-active{
  color: var(--text);
  background: linear-gradient(180deg, color-mix(in oklab, var(--surface) 98%, transparent),
                                       color-mix(in oklab, var(--panel) 96%, transparent));
  border-color: color-mix(in oklab, var(--primary) 35%, var(--border));
  box-shadow: 0 10px 28px rgba(0,0,0,.08);
}

/* ===== زرّ المفضلة فوق الصورة ===== */
.spot-media{ position:relative; overflow:hidden; border-radius:16px 16px 0 0 }
.spot-media img{ width:100%; height:220px; object-fit:cover; display:block }
.fav-btn{
  position:absolute; right:10px; top:56px;
  width:40px; height:40px; border:none; outline:none; cursor:pointer;
  border-radius:999px; background:rgba(255,255,255,0.92);
  display:flex; align-items:center; justify-content:center;
  box-shadow: 0 4px 14px rgba(0,0,0,.08);
}
.fav-btn .bi{ font-size:18px; color:#a944ec; line-height:1 }
.fav-btn.is-fav{ background:#a944ec; }
.fav-btn.is-fav .bi{ color:#fff }

/* ===== قائمة همبرغر علوية (ديسكتوب فقط هنا كستايل عام) ===== */
.topmenu{
  position: fixed;
  top: 58px;
  inset-inline-end: 12px;
  min-width: 260px; max-width: 88vw;
  padding: 8px; border-radius: 14px; border: 1px solid var(--border);
  background: linear-gradient(180deg, color-mix(in oklab, var(--surface) 100%, transparent),
                                       color-mix(in oklab, var(--panel) 98%, transparent));
  box-shadow: 0 18px 40px rgba(0,0,0,.10);
  backdrop-filter: blur(14px) saturate(120%);
  z-index: 3001; display: none; transform-origin: top right;
  transform: translateY(-6px) scale(.98); opacity: 0;
  transition: opacity .18s ease, transform .18s ease;
}
.topmenu.is-open{ display:block; opacity:1; transform: translateY(0) scale(1); }
.topmenu::before{
  content:""; position:absolute; inset-inline-end: 20px; top:-8px; width:14px; height:14px; transform: rotate(45deg);
  background: inherit; border-inline-start: 1px solid var(--border); border-top: 1px solid var(--border);
  filter: blur(.2px);
}
.topmenu-item{
  display:flex; align-items:center; gap:.6rem;
  padding:.6rem .7rem; border-radius:10px; color:inherit; text-decoration:none;
  transition: background .15s ease, transform .12s ease;
}
.topmenu-item i{ font-size:1.12rem; opacity:.9; transition: transform .15s ease, opacity .15s ease; }
.topmenu-item:hover{ background: color-mix(in oklab, var(--text) 6%, transparent); transform: translateY(-1px); }
.topmenu-item:hover i{ transform: translateY(-1px); opacity:1; }
.topmenu-sep{ height:1px; margin:.35rem .25rem; border:0; background:var(--border); }
.hamburger-btn{ width:38px; height:38px; display:grid; place-items:center; border-radius:10px; font-size:1.1rem; line-height:1; border:0; background:transparent; cursor:pointer; }
.hamburger-btn:hover{ background: color-mix(in oklab, var(--text) 6%, transparent); }

/****************************************************
 *  مـــــهــــم: شريط الموبايل السفلي (الإصدار النهائي)
 *  ثابت عند أسفل الجهاز + مرفوع 6px عن خط iPhone
 ****************************************************/
@media (max-width:768px){

  /* لمنع أي قواعد قديمة: نجبر الموضع والقيم */
  .mobile-tabbar{
    position: fixed !important;
    inset-inline: 0 !important;
    /* ارفعه 6px فوق الـ home indicator */
    bottom: calc(max(var(--safe-bottom, 0px), env(safe-area-inset-bottom, 0px)) + 6px) !important;
    height: 76px !important;

    display: grid !important;
    grid-template-columns: repeat(5,1fr) !important;
    align-items: center !important;

    background:#fff !important;
    border-top:1px solid var(--border) !important;
    backdrop-filter: blur(14px) saturate(120%) !important;

    /* Padding داخلي مع مراعاة الـsafe-area */
    padding: 10px 10px calc(12px + max(var(--safe-bottom,0px), env(safe-area-inset-bottom,0px))) !important;

    border-radius:16px 16px 0 0 !important;
    z-index:2147483647 !important;
  }
  .mobile-tabbar a{
    text-decoration:none !important; color:#6b7280 !important;
    font-size:.95rem !important; display:flex !important; flex-direction:column !important;
    align-items:center !important; gap:6px !important; line-height:1.1 !important;
  }
  .mobile-tabbar .tab-img{ width:28px !important; height:28px !important; object-fit:contain !important; opacity:.92; transition:opacity .15s, transform .15s; }
  .mobile-tabbar a.is-active{ color:#111827 !important; font-weight:800 !important; }
  .mobile-tabbar a.is-active .tab-img{ opacity:1; transform:scale(1.07); }

  /* خلفية بيضاء أسفل الجهاز حتى لا يظهر شريط iOS على المحتوى */
  body::after{
    content:""; position:fixed; left:0; right:0; bottom:0;
    height: calc(max(var(--safe-bottom,0px), env(safe-area-inset-bottom,0px)) + 12px) !important;
    background:#fff; z-index:2147483646; pointer-events:none;
  }

  /* مساحة آمنة للمحتوى أسفل الصفحة */
  .page{ padding-bottom: calc(130px + max(var(--safe-bottom,0px), env(safe-area-inset-bottom,0px))) !important; }

  /* زر + البنفسجي فوق الشريط ~14px */
  .fab, .floating-btn, .add-item-btn, .add-post-btn, .btn-fab, [class*="fab"]{
    position: fixed !important; right:16px !important;
    bottom: calc(max(var(--safe-bottom,0px), env(safe-area-inset-bottom,0px)) + 90px) !important;
    z-index:2147483647 !important; width:64px !important; height:64px !important;
    border-radius:50% !important; display:flex !important; align-items:center !important; justify-content:center !important;
    padding:0 !important; box-shadow:0 10px 28px rgba(0,0,0,.22) !important;
  }

  /* إخفاء عناصر علوية غير ضرورية على الموبايل فقط */
  #menuBtn{ display:none !important; }
}

/* ===== أيقونات وتفعيل لِون العلامة في التاب ===== */
.mobile-tabbar a { font-weight: 600; }
.mobile-tabbar a.is-active { color: var(--brand) !important; }
.mobile-tabbar a.is-active::after{
  content:""; display:block; width:28px; height:3px; border-radius:3px; background: var(--brand); margin-top:4px;
}

/* ===== تحسينات التمرير/السكرول ===== */
*{ scrollbar-width:thin; scrollbar-color: color-mix(in oklab, var(--text) 22%, transparent) transparent }
*::-webkit-scrollbar{ height:10px; width:10px }
*::-webkit-scrollbar-thumb{ background:color-mix(in oklab, var(--text) 22%, transparent); border-radius:20px }
*::-webkit-scrollbar-track{ background:transparent }

/* ------------ لوح الإشعارات (ستايل مستقل) ------------ */
.notif-panel{
  position:fixed; top:64px; bottom:0; inset-inline-end:-380px; width:360px;
  background:linear-gradient(180deg, var(--surface), var(--panel));
  border-inline-start:1px solid var(--border);
  box-shadow: -18px 0 46px rgba(0,0,0,.08);
  transition: inset-inline-end .25s ease;
  z-index:2100; display:flex; flex-direction:column;
}
.notif-panel.is-open{ inset-inline-end:0 }
.notif-panel__header{ padding:12px 14px; border-bottom:1px solid var(--border) }
.notif-panel__body{ padding:14px; overflow:auto }

.scrim{
  position:fixed; inset:0; background:#0007; opacity:0; pointer-events:none;
  transition:opacity .2s ease; z-index:2005;
}
.scrim.is-show{ opacity:1; pointer-events:auto }

/* ------------ إضافات متنوعة ------------ */
.stripe-callout{ border:1px dashed color-mix(in oklab, var(--primary) 35%, var(--border)) }
.fab{
  inset-inline-end:16px; bottom:16px; width:54px; height:54px; border-radius:50%;
  display:grid; place-items:center; color:#fff; text-decoration:none;
  background:linear-gradient(135deg,var(--primary),var(--primary-2));
  box-shadow:0 16px 40px rgba(124,92,255,.25), 0 0 0 0 rgba(124,92,255,.25);
  animation:fabpop .24s ease-out; z-index:2200
}
@keyframes fabpop{0%{transform:scale(.8); opacity:0}100%{transform:scale(1); opacity:1}}
.fab:active{ transform:scale(.96) }

/* =========================================================
   HERO — إظهار الصورة كاملة + حواف دائرية
   ========================================================= */
.hero-carousel{
  position:relative;
  border-radius:22px;
  overflow:hidden;
  box-shadow:0 10px 40px rgba(0,0,0,0.1);
  background:#f7f8fb;
}
.edge-bleed{ margin-inline:auto !important; width:100%; }
.hero-carousel .carousel-inner,
.hero-carousel .carousel-item,
.hero-carousel .carousel-item img{ border-radius:22px; overflow:hidden; }
.hero-carousel .carousel-item img{
  width:100%; height:auto; aspect-ratio:3/2;
  object-fit:contain !important; object-position:center; background:#eef2f7; display:block;
}
.hero-carousel .carousel-control-prev,
.hero-carousel .carousel-control-next{ width:8%; }
.hero-carousel .carousel-control-prev-icon,
.hero-carousel .carousel-control-next-icon{ filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
.hero-carousel .carousel-indicators{ display:none !important; }
@media (max-width:768px){
  .hero-carousel{ border-radius:18px; }
  .hero-carousel .carousel-item img{ aspect-ratio:3/2; height:auto; }
}
@media (min-width:992px){
  .hero-carousel{ max-width:1100px; margin:0 auto 20px; border-radius:24px; }
  .home-shelves{ margin-top:18px !important; }
}